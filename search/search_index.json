{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":"<p>Bienvenue dans la documentation du Projet SIO2 r\u00e9alis\u00e9e par Stefano TRIOLO et Benjamin BACLE.</p>"},{"location":"#contextualisation","title":"Contextualisation","text":"<p>L'entreprise SportLudique SARL est sp\u00e9cialis\u00e9e dans la vente d'articles de sport et de loisirs. Elle compte 452 employ\u00e9s r\u00e9partis sur 4 sites dans la r\u00e9gion Centre. Le syst\u00e8me d'information (SI) est virtualis\u00e9 \u00e0 l'aide des solutions Proxmox et Nutanix.</p>"},{"location":"#pourquoi-cette-prestation","title":"Pourquoi cette prestation ?","text":"<p>Un audit r\u00e9alis\u00e9 en 2023 a mis en lumi\u00e8re plusieurs probl\u00e8mes :</p> <ul> <li>Processus h\u00e9t\u00e9rog\u00e8nes</li> <li>Co\u00fbts \u00e9lev\u00e9s</li> <li>Faible r\u00e9activit\u00e9</li> <li>Gestion complexe du parc informatique</li> <li>S\u00e9curit\u00e9 insuffisante</li> </ul>"},{"location":"#objectifs-pour-2024-2025","title":"Objectifs pour 2024-2025","text":"<p>La Direction des Syst\u00e8mes d'Information (DSI) vise plusieurs objectifs :</p> <ul> <li>R\u00e9duire les co\u00fbts</li> <li>Am\u00e9liorer l'infrastructure</li> <li>Renforcer la s\u00e9curit\u00e9</li> </ul> <p></p>"},{"location":"Configuration-de-base/gatewayad/","title":"Configuration avanc\u00e9e du routeur TRS\u2011GW\u201102\u2011ADSL","text":""},{"location":"Configuration-de-base/gatewayad/#1-contexte-double-liaison-adsl-et-redondance","title":"1. Contexte\u00a0: double liaison ADSL et redondance","text":"<p>Sportludique exploite un r\u00e9seau d\u2019entreprise expos\u00e9 \u00e0 de fortes variations de trafic, notamment lors d\u2019\u00e9v\u00e9nements en ligne et de sessions d\u2019entra\u00eenement \u00e0 distance. Pour garantir\u202f:</p> <ul> <li>Continuit\u00e9 de service \u2013 \u00e9viter toute interruption susceptible d\u2019impacter les op\u00e9rations commerciales et l\u2019exp\u00e9rience utilisateur\u202f;</li> <li>Tol\u00e9rance aux pannes \u2013 assurer qu\u2019une d\u00e9faillance de la ligne principale n\u2019interrompe pas l\u2019acc\u00e8s au SI\u202f;</li> <li>R\u00e9partition de charge \u2013 segmenter le trafic critique (paiement, VPN, supervision) du trafic de moindre priorit\u00e9\u202f;</li> </ul> <p>le routeur TRS\u2011GW\u201102\u2011ADSL est int\u00e9gr\u00e9 avec deux liaisons ADSL redondantes (principale\u00a0+ secours). Le basculement est g\u00e9r\u00e9 localement par route statique par d\u00e9faut combin\u00e9e \u00e0 un suivi de connectivit\u00e9 (tracking)\u202f; si la ligne primaire devient indisponible, la route par d\u00e9faut est imm\u00e9diatement replac\u00e9e vers la ligne de secours.</p>"},{"location":"Configuration-de-base/gatewayad/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":""},{"location":"Configuration-de-base/gatewayad/#21-configuration-de-base","title":"2.1 Configuration de base","text":"<pre><code>conf t\nhostname TRS-GW-02-ADSL\n!\n! S\u00e9curisation du mode privil\u00e9gi\u00e9\nenable secret &lt;Secret_Privileged_Mode&gt;\n!\n! Compte d\u2019administration SSH\nusername admin privilege 15 secret &lt;Secret_Admin&gt;\n!\n! Banni\u00e8re l\u00e9gale\nbanner motd ^\n***************************************************************************\n*          Acc\u00e8s r\u00e9serv\u00e9\u00a0: toute activit\u00e9 est enregistr\u00e9e et audit\u00e9e.      *\n*     Support IT\u00a0: support@sportludique.com                                 *\n***************************************************************************\n^\nexit\n</code></pre>"},{"location":"Configuration-de-base/gatewayad/#22-configuration-des-interfaces","title":"2.2 Configuration des interfaces","text":"<pre><code>! VLAN Management (VLAN\u00a0220)\ninterface GigabitEthernet0/0.220\n encapsulation dot1Q 220\n ip address 10.10.10.2 255.255.255.0\n no shutdown\nexit\n\n! VLAN Interconnexion (VLAN\u00a0224)\ninterface GigabitEthernet0/0.224\n encapsulation dot1Q 224\n ip address 192.168.224.3 255.255.255.0\n ip nat inside\n no shutdown\nexit\n\n! Interface WAN (ADSL primaire)\ninterface GigabitEthernet0/1\n ip address 221.87.128.2 255.255.255.252\n ip nat outside\n no shutdown\nexit\n</code></pre> <p>Remarque\u00a0: dupliquer la section WAN pour la seconde liaison ADSL si celle\u2011ci est raccord\u00e9e sur une interface diff\u00e9rente (ex.\u00a0GigabitEthernet0/2).</p>"},{"location":"Configuration-de-base/gatewayad/#23-securisation-ssh","title":"2.3 S\u00e9curisation SSH","text":"<pre><code>ip domain-name sportludique.fr\nip ssh version 2\nline vty 0 4\n login local\n transport input ssh\nexit\n</code></pre>"},{"location":"Configuration-de-base/gatewayad/#24-nat-et-controle-dacces","title":"2.4 NAT et contr\u00f4le d\u2019acc\u00e8s","text":"<pre><code>! R\u00e9seaux internes autoris\u00e9s \u00e0 sortir\naccess-list 1 permit 172.28.128.0 0.0.31.255\naccess-list 1 permit 192.168.0.0   0.0.255.255\n!\n! Surcharge d\u2019adresses (PAT) vers l\u2019interface WAN\nip nat inside source list 1 interface GigabitEthernet0/1 overload\n</code></pre>"},{"location":"Configuration-de-base/gatewayad/#25-routage-statique-et-basculement","title":"2.5 Routage statique et basculement","text":"<pre><code>! Route par d\u00e9faut (liaison primaire)\nip route 0.0.0.0 0.0.0.0 221.87.128.1 track 10\n!\n! Route par d\u00e9faut de secours (poids sup\u00e9rieur)\nip route 0.0.0.0 0.0.0.0 221.87.129.1 200\n!\n! Routage interne\nip route 172.28.128.0 255.255.224.0 192.168.224.254\nip route 192.168.0.0   255.255.0.0   192.168.224.254\n</code></pre>"},{"location":"Configuration-de-base/gatewayad/#26-validation-et-tests","title":"2.6 Validation et tests","text":"<pre><code>! \u00c9tat des interfaces\nshow ip interface brief\n\n! Test de connectivit\u00e9 externe\nping 8.8.8.8 repeat 5\n\n! Traductions NAT actives\nshow ip nat translations\n</code></pre>"},{"location":"Configuration-de-base/gatewayad/#3-conclusion","title":"3. Conclusion","text":"<p>La configuration ci\u2011dessus dote le routeur TRS\u2011GW\u201102\u2011ADSL d\u2019un environnement s\u00e9curis\u00e9, redondant et pr\u00eat pour la production\u00a0:</p> <ul> <li>S\u00e9curit\u00e9 assur\u00e9e via l\u2019authentification forte, le chiffrement SSH et un contr\u00f4le d\u2019acc\u00e8s pr\u00e9cis\u00a0;</li> <li>Disponibilit\u00e9 maximis\u00e9e par la double liaison ADSL avec basculement automatique\u00a0;</li> <li>Op\u00e9rations simplifi\u00e9es gr\u00e2ce \u00e0 un jeu de commandes de validation permettant de contr\u00f4ler rapidement l\u2019\u00e9tat du syst\u00e8me.</li> </ul> <p>Cette architecture garantit \u00e0 Sportludique une connectivit\u00e9 r\u00e9siliente, r\u00e9pondant aux exigences m\u00e9tiers tout en offrant une base \u00e9volutive pour les futures extensions du r\u00e9seau.</p>"},{"location":"Configuration-de-base/gatewayfi/","title":"Configuration avanc\u00e9e du routeur TRS\u2011GW\u201101\u2011FIBRE","text":""},{"location":"Configuration-de-base/gatewayfi/#1-contexte-lien-fibre-dedie-et-exigences-de-fiabilite","title":"1. Contexte\u00a0: lien fibre d\u00e9di\u00e9 et exigences de fiabilit\u00e9","text":"<p>Sportludique d\u00e9ploie un acc\u00e8s fibre optique sym\u00e9trique pour couvrir les besoins suivants\u00a0:</p> <ul> <li>Capacit\u00e9 \u00e9lev\u00e9e\u00a0: distribution de contenus multim\u00e9dias en direct et synchronisation volumineuse de donn\u00e9es entre sites\u202f;</li> <li>Faible latence\u00a0: sessions de jeu en ligne, webinaires interactifs et solutions de bureautique cloud\u202f;</li> <li>Qualit\u00e9 de service\u00a0: s\u00e9paration des flux critiques (paiement, VPN, supervision) du trafic moins prioritaire\u202f;</li> <li>S\u00e9curit\u00e9 renforc\u00e9e\u00a0: administration distante via SSH et tra\u00e7abilit\u00e9 des modifications.</li> </ul> <p>Le routeur TRS\u2011GW\u201101\u2011FIBRE assure la passerelle principale entre le r\u00e9seau interne et Internet via une liaison fibre d\u00e9di\u00e9e. La continuit\u00e9 de service peut \u00eatre compl\u00e9t\u00e9e par un lien de secours (ADSL ou 4G) non d\u00e9crit ici.</p>"},{"location":"Configuration-de-base/gatewayfi/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":""},{"location":"Configuration-de-base/gatewayfi/#21-configuration-de-base","title":"2.1 Configuration de base","text":"<pre><code>conf t\nhostname TRS-GW-01-FIBRE\n!\n! S\u00e9curisation du mode privil\u00e9gi\u00e9\nenable secret &lt;Secret_Privileged_Mode&gt;\n!\n! Compte d\u2019administration SSH\nusername admin privilege 15 secret &lt;Secret_Admin&gt;\n!\n! Banni\u00e8re l\u00e9gale\nbanner motd ^\n***************************************************************************\n*          Acc\u00e8s r\u00e9serv\u00e9\u00a0: toute activit\u00e9 est enregistr\u00e9e et audit\u00e9e.      *\n*     Support IT\u00a0: support@sportludique.com                                 *\n***************************************************************************\n^\nexit\n</code></pre>"},{"location":"Configuration-de-base/gatewayfi/#22-configuration-des-interfaces","title":"2.2 Configuration des interfaces","text":"<pre><code>! VLAN Management (VLAN\u00a0220)\ninterface GigabitEthernet0/0.220\n encapsulation dot1Q 220\n ip address 10.10.10.1 255.255.255.0\n no shutdown\nexit\n\n! VLAN Interconnexion (VLAN\u00a0224)\ninterface GigabitEthernet0/0.224\n encapsulation dot1Q 224\n ip address 192.168.224.2 255.255.255.0\n ip nat inside\n ip virtual-reassembly in\n no shutdown\nexit\n\n! Interface WAN fibre (acc\u00e8s d\u00e9di\u00e9)\ninterface GigabitEthernet0/1\n ip address 183.44.37.1 255.255.255.252\n ip nat outside\n ip virtual-reassembly in\n no shutdown\nexit\n</code></pre> <p>Note\u00a0: si une seconde fibre ou un lien de secours est pr\u00e9vu, r\u00e9pliquer la section WAN sur l\u2019interface concern\u00e9e et mettre en place un suivi (track) pour la route par d\u00e9faut.</p>"},{"location":"Configuration-de-base/gatewayfi/#23-securisation-ssh","title":"2.3 S\u00e9curisation SSH","text":"<pre><code>ip domain-name sportludique.fr\nip ssh version 2\nline vty 0 4\n login local\n transport input ssh\nexit\n</code></pre>"},{"location":"Configuration-de-base/gatewayfi/#24-nat-et-controle-dacces","title":"2.4 NAT et contr\u00f4le d\u2019acc\u00e8s","text":"<pre><code>! R\u00e9seaux internes autoris\u00e9s \u00e0 sortir\naccess-list 1 permit 172.28.128.0 0.0.31.255\naccess-list 1 permit 192.168.0.0   0.0.255.255\n!\n! NAT surcharge (PAT) vers la fibre\nip nat inside source list 1 interface GigabitEthernet0/1 overload\n</code></pre>"},{"location":"Configuration-de-base/gatewayfi/#25-routage-statique","title":"2.5 Routage statique","text":"<pre><code>! Route par d\u00e9faut vers le FAI fibre\nip route 0.0.0.0 0.0.0.0 183.44.37.2\n!\n! Routage interne\nip route 172.28.128.0 255.255.224.0 192.168.224.254\nip route 192.168.0.0   255.255.0.0   192.168.224.254\n</code></pre>"},{"location":"Configuration-de-base/gatewayfi/#26-validation-et-tests","title":"2.6 Validation et tests","text":"<pre><code>! \u00c9tat des interfaces\nshow ip interface brief\n\n! Test de connectivit\u00e9 externe\nping 8.8.8.8 repeat 5\n\n! Traductions NAT actives\nshow ip nat translations\n</code></pre>"},{"location":"Configuration-de-base/gatewayfi/#3-conclusion","title":"3. Conclusion","text":"<p>Cette configuration place le routeur TRS\u2011GW\u201101\u2011FIBRE au c\u0153ur du r\u00e9seau Sportludique avec\u00a0:</p> <ul> <li>S\u00e9curit\u00e9\u202f: authentification locale forte, chiffrement SSH et banni\u00e8re l\u00e9gale\u202f;</li> <li>Performance\u202f: liaison fibre \u00e0 haut d\u00e9bit, VLAN d\u00e9di\u00e9 au management et NAT optimis\u00e9\u202f;</li> <li>Simplicit\u00e9 op\u00e9rationnelle\u202f: commandes de v\u00e9rification rapides pour le support NOC.</li> </ul> <p>Elle fournit une base fiable et \u00e9volutive pour les futurs services (QoS avanc\u00e9e, IPSec, redondance multi\u2011WAN) tout en r\u00e9pondant aux exigences actuelles de l\u2019entreprise.</p>"},{"location":"Configuration-de-base/switch-core/","title":"Guide de configuration \u2013 Switch c\u0153ur TRS\u2011SW\u2011CORE","text":""},{"location":"Configuration-de-base/switch-core/#1-contexte-role-central-et-exigences-de-performance","title":"1. Contexte : r\u00f4le central et exigences de performance","text":"<p>Le switch TRS\u2011SW\u2011CORE est le n\u0153ud principal de l\u2019infrastructure Sportludique. Il agr\u00e8ge le trafic des switches de distribution, assure le routage inter\u2011VLAN et relaie les flux vers la passerelle Internet. Les objectifs cl\u00e9s demeurent\u00a0:</p> <ul> <li>D\u00e9bit \u00e9lev\u00e9\u00a0: commutation L2/L3 avec forte capacit\u00e9 de traitement.</li> <li>Routage inter\u2011VLAN\u00a0: distribution efficace du trafic entre segments logiques.</li> <li>Haute disponibilit\u00e9\u00a0: liens agr\u00e9g\u00e9s (Port\u2011Channel\u202f1) et trunks multiples.</li> <li>S\u00e9curit\u00e9 d\u2019administration\u00a0: gestion isol\u00e9e via le VLAN\u00a0220 et SSH.</li> </ul>"},{"location":"Configuration-de-base/switch-core/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":""},{"location":"Configuration-de-base/switch-core/#21-configuration-de-base","title":"2.1 Configuration de base","text":"<pre><code>conf t\nhostname TRS-SW-CORE\n!\n! Mot de passe privil\u00e9gi\u00e9\nenable secret &lt;Secret_Privileged_Mode&gt;\n!\n! Compte d\u2019administration\nusername admin privilege 15 secret &lt;Secret_Admin&gt;\n!\n! Banni\u00e8re l\u00e9gale\nbanner motd ^\n***************************************************************************\n*      Acc\u00e8s r\u00e9serv\u00e9\u00a0: toute activit\u00e9 est enregistr\u00e9e et audit\u00e9e.          *\n*      Support IT\u00a0: support@sportludiques.com                               *\n***************************************************************************\n^\nexit\n</code></pre>"},{"location":"Configuration-de-base/switch-core/#22-vlan-de-management-et-svi","title":"2.2 VLAN de management et SVI","text":"<pre><code>interface Vlan220\n ip address 10.10.10.10 255.255.255.0\n ip helper-address 172.28.131.50\n ip access-group ALLOW_SSH_VLAN220 in\n no shutdown\n</code></pre>"},{"location":"Configuration-de-base/switch-core/#23-definition-des-vlans","title":"2.3 D\u00e9finition des VLANs","text":"<pre>\nvlan 125\n name Infra_Backup\n!\nvlan 220\n name Management\n!\nvlan 221\n name Services\n!\nvlan 222\n name DMZ\n!\nvlan 223\n name A_Definir\n!\nvlan 224\n name Interconnexion\n!\nvlan 225\n name Production\n!\nvlan 226\n name Conception\n!\nvlan 227\n name Tests\n!\nvlan 228\n name OT_Zone\n!\nvlan 229\n name Transit\n</pre>"},{"location":"Configuration-de-base/switch-core/#24-svis-supplementaires","title":"2.4 SVIs suppl\u00e9mentaires","text":"<pre><code>interface Vlan125\n ip address 192.168.125.1 255.255.255.0\n!\ninterface Vlan221\n ip address 172.28.131.1 255.255.255.0\n ip access-group ALLOW_SSH_VLAN220 in\n!\ninterface Vlan225\n ip address 172.28.135.1 255.255.255.0\n ip access-group ALLOW_SSH_VLAN220 in\n!\ninterface Vlan226\n ip address 172.28.136.1 255.255.255.0\n ip access-group ALLOW_SSH_VLAN220 in\n!\ninterface Vlan227\n ip address 172.28.137.1 255.255.255.0\n ip helper-address 172.28.131.50\n ip access-group ALLOW_SSH_VLAN220 in\n!\ninterface Vlan228\n ip address 172.28.138.10 255.255.255.0\n!\ninterface Vlan229\n ip address 192.168.229.254 255.255.255.0\n ip access-group ALLOW_SSH_VLAN220 in\n</code></pre>"},{"location":"Configuration-de-base/switch-core/#25-securisation-de-lacces-distant-ssh","title":"2.5 S\u00e9curisation de l\u2019acc\u00e8s distant (SSH)","text":"<pre><code>ip domain-name sportludique.fr\ncrypto key generate rsa modulus 2048\nip ssh version 2\nline vty 0 4\n login local\n transport input ssh\nline vty 5 15\n login local\n transport input ssh\nexit\n</code></pre>"},{"location":"Configuration-de-base/switch-core/#26-routage-ip","title":"2.6 Routage IP","text":"<pre><code>ip routing\nip route 0.0.0.0 0.0.0.0 192.168.229.1\n</code></pre>"},{"location":"Configuration-de-base/switch-core/#27-listes-de-controle-dacces","title":"2.7 Listes de contr\u00f4le d\u2019acc\u00e8s","text":"<pre><code>ip access-list extended ALLOW_SSH_VLAN220\n 10 permit tcp 10.10.10.0 0.0.0.255 any eq 22\n 20 deny   tcp any any eq 22\n 30 permit ip any any\n</code></pre>"},{"location":"Configuration-de-base/switch-core/#28-agregation-et-ports-trunk","title":"2.8 Agr\u00e9gation et ports trunk","text":"<pre><code>! Port\u2011Channel d\u2019uplink principal\ninterface Port-channel1\n switchport mode trunk\n!\ninterface GigabitEthernet1/0/18\n description \"Uplink LACP\"\n switchport mode trunk\n channel-group 1 mode active\n!\ninterface GigabitEthernet1/0/19\n description \"Uplink LACP\"\n switchport mode trunk\n channel-group 1 mode active\n!\n! Trunks additionnels\ninterface GigabitEthernet1/0/20\n switchport mode trunk\n!\ninterface GigabitEthernet1/0/21\n switchport mode trunk\n!\ninterface GigabitEthernet1/0/22\n switchport mode trunk\n!\ninterface GigabitEthernet1/0/23\n switchport mode trunk\n!\ninterface GigabitEthernet1/0/24\n switchport mode trunk\n</code></pre>"},{"location":"Configuration-de-base/switch-core/#29-ports-dacces","title":"2.9 Ports d\u2019acc\u00e8s","text":"<pre><code>interface GigabitEthernet1/0/1\n switchport mode access\n switchport access vlan 220\n!\ninterface GigabitEthernet1/0/2\n switchport mode access\n switchport access vlan 220\n!\ninterface GigabitEthernet1/0/3\n switchport mode access\n switchport access vlan 221\n shutdown\n!\ninterface GigabitEthernet1/0/4\n switchport mode access\n switchport access vlan 221\n!\ninterface GigabitEthernet1/0/5\n switchport mode access\n switchport access vlan 222\n!\ninterface GigabitEthernet1/0/6\n switchport mode access\n switchport access vlan 222\n!\ninterface GigabitEthernet1/0/7\n switchport mode access\n switchport access vlan 223\n!\ninterface GigabitEthernet1/0/8\n switchport mode access\n switchport access vlan 223\n!\ninterface GigabitEthernet1/0/9\n switchport mode access\n switchport access vlan 224\n!\ninterface GigabitEthernet1/0/10\n switchport mode access\n switchport access vlan 224\n</code></pre>"},{"location":"Configuration-de-base/switch-core/#3-conclusion","title":"3. Conclusion","text":"<p>La documentation refl\u00e8te d\u00e9sormais la configuration effective de TRS\u2011SW\u2011CORE\u00a0:</p> <ul> <li>Administration s\u00e9curis\u00e9e via le VLAN\u00a0220, ACL cibl\u00e9e et SSH v2.</li> <li>Segmentation \u00e9tendue (VLAN\u202f125,\u202f220\u2011229) avec SVIs et relais DHCP.</li> <li>Connectivit\u00e9 redondante gr\u00e2ce au Port\u2011Channel\u202f1 et \u00e0 plusieurs trunks.</li> <li>Passerelle par d\u00e9faut vers 192.168.229.1, assurant la sortie Internet.</li> </ul> <p>Cette base garantit la performance, la r\u00e9silience et la conformit\u00e9 aux standards Sportludique, tout en restant pr\u00eate pour des extensions futures (QoS, 802.1X, monitoring SNMP). </p>"},{"location":"Configuration-de-base/switch-distribution/","title":"Guide de configuration \u2013 Switch de distribution SW\u2011DISTRIB\u2011TOURS","text":""},{"location":"Configuration-de-base/switch-distribution/#1-contexte-role-de-distribution-et-segmentation-reseau","title":"1. Contexte\u00a0: r\u00f4le de distribution et segmentation r\u00e9seau","text":"<p>Le switch SW\u2011DISTRIB\u2011TOURS constitue le c\u0153ur de distribution du site de\u202fTours\u202f; il agr\u00e8ge les liaisons d\u2019acc\u00e8s, concentre les VLAN et relaie le trafic vers la passerelle Internet. Ses objectifs sont\u202f:</p> <ul> <li>Segmentation\u202f: isoler les flux par usage (management, DMZ, production, conception, etc.)\u202f;</li> <li>Haute disponibilit\u00e9\u202f: proposer des liaisons trunk redondantes vers le c\u0153ur et \u00e9viter les boucles via Spanning\u00a0Tree\u202f;</li> <li>S\u00e9curit\u00e9 d\u2019administration\u202f: limiter la gestion de l\u2019\u00e9quipement au VLAN de management et aux sessions SSH chiffr\u00e9es.</li> </ul>"},{"location":"Configuration-de-base/switch-distribution/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":""},{"location":"Configuration-de-base/switch-distribution/#21-configuration-de-base","title":"2.1 Configuration de base","text":"<pre><code>conf t\nhostname SW-DISTRIB-TOURS\n!\n! Mot de passe privil\u00e9gi\u00e9\nenable secret &lt;Secret_Privileged_Mode&gt;\n!\n! Compte d\u2019administration\nusername admin privilege 15 secret &lt;Secret_Admin&gt;\n!\n! Banni\u00e8re l\u00e9gale\nbanner motd ^\n***************************************************************************\n*      Acc\u00e8s r\u00e9serv\u00e9\u00a0: toute activit\u00e9 est enregistr\u00e9e et audit\u00e9e.         *\n*      Support\u00a0IT\u00a0: support@sportludiques.com                              *\n***************************************************************************\n^\nexit\n</code></pre>"},{"location":"Configuration-de-base/switch-distribution/#22-vlan-de-management-et-svi","title":"2.2 VLAN de management et SVI","text":"<pre><code>vlan 220\n name Management\n!\ninterface Vlan220\n ip address 10.10.10.20 255.255.255.0\n no shutdown\n</code></pre>"},{"location":"Configuration-de-base/switch-distribution/#23-definition-des-vlans-de-service","title":"2.3 D\u00e9finition des VLANs de service","text":"<pre><code>vlan 221\n name Services\nvlan 222\n name DMZ\nvlan 223\n name A_Definir\nvlan 224\n name Interconnexion\nvlan 225\n name Production\nvlan 226\n name Conception\n</code></pre>"},{"location":"Configuration-de-base/switch-distribution/#24-securisation-de-lacces-distant-ssh","title":"2.4 S\u00e9curisation de l\u2019acc\u00e8s distant (SSH)","text":"<pre><code>ip domain-name sportludique.fr\ncrypto key generate rsa modulus 2048\nip ssh version 2\nline vty 0 4\n login local\n transport input ssh\nexit\n</code></pre>"},{"location":"Configuration-de-base/switch-distribution/#25-configuration-des-ports","title":"2.5 Configuration des ports","text":"<pre><code>! Uplink trunk vers le c\u0153ur\ninterface GigabitEthernet0/24\n description Uplink_Core\n switchport mode trunk\n spanning-tree portfast disable\n no shutdown\n!\n! Ports d\u2019acc\u00e8s utilisateurs\ninterface GigabitEthernet0/1\n description Poste_Admin1\n switchport mode access\n switchport access vlan 220\n spanning-tree portfast\n no shutdown\n!\ninterface GigabitEthernet0/2\n description Poste_Admin2\n switchport mode access\n switchport access vlan 220\n spanning-tree portfast\n no shutdown\n!\ninterface GigabitEthernet0/3\n description Serveur_DMZ\n switchport mode access\n switchport access vlan 222\n spanning-tree portfast\n no shutdown\n!\ninterface GigabitEthernet0/4\n description Banc_Conception\n switchport mode access\n switchport access vlan 226\n spanning-tree portfast\n no shutdown\n</code></pre>"},{"location":"Configuration-de-base/switch-distribution/#3-conclusion","title":"3. Conclusion","text":"<p>Cette configuration conf\u00e8re \u00e0 SW\u2011DISTRIB\u2011TOURS\u00a0:</p> <ul> <li>Une administration s\u00e9curis\u00e9e au travers du VLAN\u00a0220 et de SSH\u00a0v2\u202f;</li> <li>Une segmentation claire gr\u00e2ce \u00e0 des VLAN d\u00e9di\u00e9s aux diff\u00e9rents usages\u202f;</li> <li>Une int\u00e9gration transparente avec le c\u0153ur du r\u00e9seau par le trunk principal, pr\u00eat \u00e0 \u00eatre doubl\u00e9 pour la redondance si n\u00e9cessaire.</li> </ul> <p>Le switch est ainsi align\u00e9 sur les standards Sportludique et peut \u00e9voluer vers des fonctionnalit\u00e9s avanc\u00e9es (QoS, 802.1X, agr\u00e9gation de liens, supervision\u00a0SNMP) sans modifier la configuration actuelle.</p>"},{"location":"Hypervision/dockernode/","title":"Cr\u00e9er une application Node.js avec Docker","text":"<p>Ce guide explique comment cr\u00e9er une application Node.js et la faire fonctionner dans un conteneur Docker.</p>"},{"location":"Hypervision/dockernode/#etape-1-creer-le-repertoire-de-lapplication","title":"\u00c9tape 1 : Cr\u00e9er le r\u00e9pertoire de l'application","text":"<p>Cr\u00e9ez un dossier pour votre projet et acc\u00e9dez-y dans votre terminal.</p> <pre><code>mkdir my-node-app\ncd my-node-app\n</code></pre>"},{"location":"Hypervision/dockernode/#etape-2-initialiser-le-projet-nodejs","title":"\u00c9tape 2 : Initialiser le projet Node.js","text":"<p>Initialisez un nouveau projet Node.js avec npm :</p> <pre><code>npm init -y\n</code></pre> <p>Ce fichier contient les m\u00e9tadonn\u00e9es de votre projet, telles que son nom et ses d\u00e9pendances.</p>"},{"location":"Hypervision/dockernode/#etape-3-creer-le-fichier-principal","title":"\u00c9tape 3 : Cr\u00e9er le fichier principal","text":"<p>Cr\u00e9ez un fichier <code>app.js</code> avec ce contenu :</p> <pre><code>const express = require('express');\nconst app = express();\n\napp.get('/', (req, res) =&gt; {\n    res.send('Bonjour, Docker et Node.js!');\n});\n\nconst PORT = 3000;\napp.listen(PORT, () =&gt; {\n    console.log(`Serveur lanc\u00e9 sur le port ${PORT}`);\n});\n</code></pre>"},{"location":"Hypervision/dockernode/#etape-4-installer-les-dependances","title":"\u00c9tape 4 : Installer les d\u00e9pendances","text":"<p>Ajoutez Express, un framework minimaliste pour Node.js :</p> <pre><code>npm install express\n</code></pre>"},{"location":"Hypervision/dockernode/#etape-5-tester-lapplication-localement","title":"\u00c9tape 5 : Tester l'application localement","text":"<p>Pour tester votre application en dehors de Docker, ex\u00e9cutez-la avec Node.js :</p> <pre><code>node app.js\n</code></pre> <p>Ensuite, ouvrez votre navigateur et acc\u00e9dez \u00e0 <code>http://localhost:3000</code>. Vous devriez voir le message suivant :</p> <p>Bonjour, Docker et Node.js!</p>"},{"location":"Hypervision/dockernode/#etape-6-creer-le-fichier-dockerfile","title":"\u00c9tape 6 : Cr\u00e9er le fichier Dockerfile","text":"<p>Ajoutez un fichier <code>Dockerfile</code> pour d\u00e9finir l'environnement de votre application :</p> <pre><code># Utiliser une image Node.js officielle\nFROM node:16\n\n# D\u00e9finir le r\u00e9pertoire de travail\nWORKDIR /usr/src/app\n\n# Copier les fichiers package.json et installer les d\u00e9pendances\nCOPY package*.json ./\nRUN npm install\n\n# Copier tout le code dans le conteneur\nCOPY . .\n\n# Exposer le port 3000\nEXPOSE 3000\n\n# D\u00e9marrer l'application\nCMD [\"node\", \"app.js\"]\n</code></pre>"},{"location":"Hypervision/dockernode/#etape-7-construire-limage-docker","title":"\u00c9tape 7 : Construire l'image Docker","text":"<p>Dans le r\u00e9pertoire de votre projet, ex\u00e9cutez cette commande pour cr\u00e9er une image Docker :</p> <pre><code>docker build -t my-node-app .\n</code></pre>"},{"location":"Hypervision/dockernode/#etape-8-lancer-le-conteneur","title":"\u00c9tape 8 : Lancer le conteneur","text":"<p>Pour ex\u00e9cuter l'application dans un conteneur, utilisez la commande suivante :</p> <pre><code>docker run -p 3000:3000 my-node-app\n</code></pre> <p>L'application est maintenant accessible \u00e0 l'adresse suivante : http://localhost:3000.</p>"},{"location":"Hypervision/dockernode/#etape-9-arreter-le-conteneur","title":"\u00c9tape 9 : Arr\u00eater le conteneur","text":"<p>Pour arr\u00eater le conteneur, trouvez son ID avec :</p> <pre><code>docker ps\n</code></pre> <p>Puis arr\u00eatez-le avec :</p> <pre><code>docker stop &lt;container-id&gt;\n</code></pre>"},{"location":"Hypervision/dockernode/#etape-10-tester-lapplication","title":"\u00c9tape 10 : Tester l'application","text":"<p>Pour v\u00e9rifier que tout fonctionne, ouvrez un navigateur ou utilisez une commande <code>curl</code> :</p> <pre><code>curl http://localhost:3000\n</code></pre> <p>Vous devriez voir :</p> <p>Bonjour, Docker et Node.js!</p> <p>Vous avez maintenant une application Node.js fonctionnant dans Docker ! \ud83c\udf89</p>"},{"location":"Hypervision/Proxmox/httpsprx/","title":"S\u00e9curisation de Proxmox en HTTPS avec certificat sign\u00e9 (ACG-SL)","text":""},{"location":"Hypervision/Proxmox/httpsprx/#objectif","title":"Objectif","text":"<p>Garantir une connexion chiffr\u00e9e et de confiance \u00e0 l'interface web de Proxmox via le protocole HTTPS, \u00e0 l\u2019aide d\u2019un certificat sign\u00e9 par l\u2019Autorit\u00e9 de Certification G\u00e9n\u00e9rale de SportLudique (ACG-SL).</p>"},{"location":"Hypervision/Proxmox/httpsprx/#1-generation-du-certificat-ssl","title":"1. G\u00e9n\u00e9ration du certificat SSL","text":"<p>La g\u00e9n\u00e9ration du certificat se fait sur le serveur de l\u2019autorit\u00e9 de certification interne : trustus.mana.lan.</p>"},{"location":"Hypervision/Proxmox/httpsprx/#etapes","title":"\ud83d\udccd \u00c9tapes :","text":"<ol> <li>Se connecter en SSH :</li> </ol> <pre><code>ssh admin@trustus.mana.lan\n</code></pre> <ol> <li>Aller dans le dossier contenant l\u2019ACG-SL :</li> </ol> <pre><code>cd ~/ACG-SL\n</code></pre> <ol> <li>Ex\u00e9cuter le script pour g\u00e9n\u00e9rer un certificat wildcard :</li> </ol> <pre><code>./wildcard.sh mana.lan\n</code></pre> <p>\u2705 Cette m\u00e9thode permet d\u2019avoir un seul certificat valide pour tous les services en <code>*.mana.lan</code>, dont <code>proxmox.mana.lan</code>.</p> <p>\ud83d\udd10 Le VLAN de management \u00e9tant isol\u00e9, cette m\u00e9thode n'entra\u00eene aucun risque de s\u00e9curit\u00e9 li\u00e9 aux certificats wildcard.</p>"},{"location":"Hypervision/Proxmox/httpsprx/#2-ajout-dns-du-fqdn-proxmoxmanalan","title":"2. Ajout DNS du FQDN <code>proxmox.mana.lan</code>","text":"<p>Avant de d\u00e9ployer le certificat, il faut s\u2019assurer que le nom de domaine <code>proxmox.mana.lan</code> est bien r\u00e9solu en local.</p>"},{"location":"Hypervision/Proxmox/httpsprx/#a-faire-dans-le-serveur-dns-principal-trs-srv-dns1","title":"\ud83d\udccd \u00c0 faire dans le serveur DNS principal <code>trs-srv-dns1</code> :","text":"<ol> <li>Ouvrir la zone <code>mana.lan</code></li> <li>Cr\u00e9er un enregistrement A :</li> </ol> Nom Type Adresse IP proxmox.mana.lan A <code>10.10.10.5</code> (exemple)"},{"location":"Hypervision/Proxmox/httpsprx/#3-deploiement-du-certificat-sur-proxmox","title":"3. D\u00e9ploiement du certificat sur Proxmox","text":"<p>Une fois le certificat <code>wildcard.mana.lan.pem</code> et sa cl\u00e9 priv\u00e9e obtenus, les copier sur le serveur Proxmox (<code>10.10.10.5</code> dans l'exemple) :</p> <pre><code>scp wildcard.mana.lan.pem root@10.10.10.5:/etc/pve/local/pve-ssl.pem\nscp wildcard.mana.lan.key root@10.10.10.5:/etc/pve/local/pve-ssl.key\n</code></pre> <p>Ensuite, red\u00e9marrer le service web de Proxmox pour activer le certificat :</p> <pre><code>systemctl restart pveproxy\n</code></pre>"},{"location":"Hypervision/Proxmox/httpsprx/#4-verification-via-navigateur","title":"4. V\u00e9rification via navigateur","text":"<p>Acc\u00e9der \u00e0 l'interface web depuis un poste client :</p> <p>\ud83d\udc49 https://proxmox.mana.lan:8006</p> <p>Si tout est bien configur\u00e9, le certificat est reconnu comme valide dans le navigateur.</p> <p></p>"},{"location":"Hypervision/Proxmox/httpsprx/#resultat-attendu","title":"R\u00e9sultat attendu","text":"<ul> <li>\ud83d\udd12 Le certificat SSL wildcard couvre l\u2019ensemble des sous-domaines <code>*.mana.lan</code></li> <li>\ud83c\udf10 Le nom <code>proxmox.mana.lan</code> pointe vers le serveur Proxmox sur le r\u00e9seau de management</li> <li>\u2705 L\u2019acc\u00e8s est s\u00e9curis\u00e9 et reconnu par le navigateur</li> </ul>"},{"location":"Hypervision/Proxmox/intro/","title":"Introduction au Projet Proxmox - SportLudique Tours","text":""},{"location":"Hypervision/Proxmox/intro/#cahier-des-charges","title":"Cahier des charges","text":"<p>Dans le cadre de l'am\u00e9lioration de l'autonomie informatique du site de Tours, le DSI de SportLudique a d\u00e9fini un cahier des charges pr\u00e9cis pour la mise en place d\u2019un hyperviseur local bas\u00e9 sur Proxmox VE. Ce dernier doit permettre la continuit\u00e9 des services en cas de coupure avec le si\u00e8ge, tout en garantissant la s\u00e9curit\u00e9 et la performance de l\u2019infrastructure.</p> <p>Les \u00e9l\u00e9ments suivants sont requis :</p> <ul> <li>\ud83d\udce6 D\u00e9ploiement d\u2019un hyperviseur Proxmox local pour h\u00e9berger un double de chaque machine critique.</li> <li>\ud83e\uddf1 Configuration des disques avec LVM pour le syst\u00e8me et cr\u00e9ation d\u2019un pool ZFS d\u00e9di\u00e9 aux machines virtuelles.</li> <li>\ud83c\udf10 Architecture r\u00e9seau redondante via l\u2019usage de plusieurs interfaces physiques r\u00e9parties sur diff\u00e9rents VLANs et une agr\u00e9gation LACP.</li> <li>\ud83d\udd10 Authentification centralis\u00e9e via les identifiants Active Directory, int\u00e9gr\u00e9e au domaine <code>lan.tours.sportludique.fr</code>.</li> <li>\ud83d\udd12 Connexion s\u00e9curis\u00e9e en HTTPS, avec un certificat sign\u00e9 par l\u2019ACG-SL (Autorit\u00e9 de Certification G\u00e9n\u00e9rale de SportLudique).</li> <li>\ud83e\uddd1\u200d\ud83d\udcbb S\u00e9paration des acc\u00e8s : seul un groupe AD sp\u00e9cifique (ex. : <code>proxmox-admins</code>) peut acc\u00e9der \u00e0 l'interface d'administration.</li> <li>\ud83d\udcdc Documenter toute la proc\u00e9dure d'installation et de configuration pour assurer la maintenabilit\u00e9 du projet.</li> </ul>"},{"location":"Hypervision/Proxmox/intro/#contexte","title":"Contexte","text":"<p>Afin de limiter la d\u00e9pendance vis-\u00e0-vis du cloud centralis\u00e9 g\u00e9r\u00e9 par le si\u00e8ge, et dans une optique de continuit\u00e9 de service en cas de coupure ou de perte de liaison avec celui-ci, le DSI de SportLudique bas\u00e9 \u00e0 Tours a d\u00e9cid\u00e9 de mettre en place une infrastructure locale de virtualisation.</p> <p>Cette infrastructure repose sur Proxmox VE, un hyperviseur libre et robuste, permettant de faire tourner plusieurs machines virtuelles localement. L\u2019objectif est de maintenir un double de chaque machine critique au niveau local pour garantir la redondance et l\u2019autonomie en cas d\u2019incident.</p>"},{"location":"Hypervision/Proxmox/intro/#infrastructure-disque","title":"Infrastructure Disque","text":"<p>Le serveur physique d\u00e9di\u00e9 \u00e0 l\u2019hyperviseur Proxmox dispose d\u2019un disque de 600 Go organis\u00e9 comme suit :</p> <p></p> <ul> <li><code>/dev/sda1</code> (1 Go) : contient la partition de d\u00e9marrage (<code>/boot</code>).</li> <li><code>/dev/sda2</code> (50 Go) : regroupe les volumes logiques critiques du syst\u00e8me :</li> <li><code>LV-SYSTEM</code> (15 Go) \u2192 <code>/</code></li> <li><code>LV-LOG</code> (15 Go) \u2192 <code>/var/log</code></li> <li><code>LV-SWAP</code> (10 Go) \u2192 swap</li> <li><code>/dev/sda3</code> (400 Go) : destin\u00e9 aux machines virtuelles dans le groupe <code>VGVMs</code> :</li> <li>Pool ZFS <code>VM-ZFS</code> :<ul> <li><code>LV-VM-ZFS</code> (100 Go)</li> <li><code>LV-VM-ZFS-2</code> (100 Go)</li> </ul> </li> <li>Volume <code>LV-ISOC</code> (50 Go) \u2192 utilis\u00e9 pour stocker les ISO \u00e0 monter dans les VMs</li> <li>149 Go non allou\u00e9s pour permettre des extensions futures.</li> </ul>"},{"location":"Hypervision/Proxmox/intro/#interfaces-reseau","title":"Interfaces R\u00e9seau","text":"<p>Le serveur est \u00e9quip\u00e9 de deux cartes r\u00e9seau physiques (multi-ports), configur\u00e9es pour s\u00e9parer les usages (gestion, services, agr\u00e9gation LACP) :</p> <p></p> <ul> <li>Carte 1 (4 ports) :</li> <li><code>eno1</code> : agr\u00e9gation LACP (VLAN 220-229) \u2013 [active]</li> <li><code>eno2</code> : r\u00e9seau de gestion \u2013 IP : <code>10.10.10.5/24</code> \u2013 [active]</li> <li><code>eno3</code> : r\u00e9seau des services \u2013 IP : <code>172.28.131.5/24</code> \u2013 [active]</li> <li><code>eno4</code> : port inactif</li> <li>Carte 2 (2 ports) :</li> <li><code>enp5s0f0</code> : LACP (VLAN 220-229) \u2013 [active]</li> <li><code>enp5s0f1</code> : inactif</li> </ul> <p>Cette segmentation permet une s\u00e9paration des flux critique pour la s\u00e9curit\u00e9 et les performances, tout en offrant une tol\u00e9rance aux pannes r\u00e9seau via l'agr\u00e9gation LACP.</p>"},{"location":"Hypervision/Proxmox/intro/#objectifs-du-projet","title":"Objectifs du Projet","text":"<ul> <li>Autonomie locale en cas de coupure avec le si\u00e8ge.</li> <li>Redondance des services gr\u00e2ce aux VM locales.</li> <li>Optimisation r\u00e9seau avec s\u00e9paration des VLANs.</li> <li>Facilit\u00e9 de maintenance avec un syst\u00e8me standardis\u00e9 et document\u00e9.</li> </ul> <p>Ce projet s'inscrit dans une volont\u00e9 plus large de r\u00e9silience et de ma\u00eetrise des ressources informatiques locales.</p>"},{"location":"Hypervision/Proxmox/proxmox/","title":"\ud83d\ude80 Installer Proxmox VE","text":""},{"location":"Hypervision/Proxmox/proxmox/#objectif","title":"\ud83d\udccb Objectif","text":"<p>Ce tutoriel d\u00e9crit toutes les \u00e9tapes n\u00e9cessaires pour installer Proxmox VE sur un serveur Debian, avec les optimisations post-installation pour un environnement fonctionnel et s\u00e9curis\u00e9.</p>"},{"location":"Hypervision/Proxmox/proxmox/#etape-1-adapter-le-fichier-sourceslist","title":"\ud83d\udee0\ufe0f \u00c9tape 1 : Adapter le fichier <code>sources.list</code>","text":"<p>Ajoutez le d\u00e9p\u00f4t Proxmox VE avec la commande suivante :</p> <pre><code>echo \"deb [arch=amd64] http://download.proxmox.com/debian/pve bookworm pve-no-subscription\" &gt; /etc/apt/sources.list.d/pve-install-repo.list\n</code></pre> <p>T\u00e9l\u00e9chargez et ajoutez la cl\u00e9 de ce d\u00e9p\u00f4t :</p> <pre><code>wget https://enterprise.proxmox.com/debian/proxmox-release-bookworm.gpg -O /etc/apt/trusted.gpg.d/proxmox-release-bookworm.gpg\n</code></pre> <p>V\u00e9rifiez son int\u00e9grit\u00e9 :</p> <pre><code>sha512sum /etc/apt/trusted.gpg.d/proxmox-release-bookworm.gpg\n# R\u00e9sultat attendu :\n# 7da6fe34168adc6e479327ba517796d4702fa2f8b4f0a9833f5ea6e6b48f6507a6da403a274fe201595edc86a84463d50383d07f64bdde2e3658108db7d6dc87\n</code></pre>"},{"location":"Hypervision/Proxmox/proxmox/#etape-2-mise-a-jour-des-depots-et-du-systeme","title":"\ud83d\udd04 \u00c9tape 2 : Mise \u00e0 jour des d\u00e9p\u00f4ts et du syst\u00e8me","text":"<p>Mettez \u00e0 jour les paquets et appliquez les mises \u00e0 jour syst\u00e8me avec :</p> <pre><code>apt update &amp;&amp; apt full-upgrade\n</code></pre>"},{"location":"Hypervision/Proxmox/proxmox/#etape-3-installer-le-noyau-proxmox-ve","title":"\ud83e\udde9 \u00c9tape 3 : Installer le noyau Proxmox VE","text":"<p>Installez et red\u00e9marrez sur le noyau Proxmox VE :</p> <pre><code>apt install proxmox-default-kernel\nsystemctl reboot\n</code></pre>"},{"location":"Hypervision/Proxmox/proxmox/#etape-4-installer-les-paquets-proxmox-ve","title":"\ud83d\udce6 \u00c9tape 4 : Installer les paquets Proxmox VE","text":"<p>Installez les composants essentiels pour Proxmox VE :</p> <pre><code>apt install proxmox-ve postfix open-iscsi chrony\n</code></pre> <p>Pendant l'installation, configurez <code>postfix</code> selon vos besoins. Choisissez \"local only\" si vous ne g\u00e9rez pas de serveur mail.</p>"},{"location":"Hypervision/Proxmox/proxmox/#etape-5-supprimer-le-noyau-debian","title":"\u274c \u00c9tape 5 : Supprimer le noyau Debian","text":"<p>Pour \u00e9viter les conflits de versions, supprimez le noyau par d\u00e9faut de Debian :</p> <pre><code>apt remove linux-image-amd64 'linux-image-6.1*'\n</code></pre> <p>Mettez \u00e0 jour et v\u00e9rifiez la configuration de <code>grub2</code> :</p> <pre><code>update-grub\n</code></pre>"},{"location":"Hypervision/Proxmox/proxmox/#etape-6-optionnel-supprimer-os-prober","title":"\ud83e\uddf9 \u00c9tape 6 : Optionnel - Supprimer <code>os-prober</code>","text":"<p>Supprimez <code>os-prober</code> si vous n'utilisez pas de dual boot, pour \u00e9viter des entr\u00e9es de d\u00e9marrage incorrectes :</p> <pre><code>apt remove os-prober\n</code></pre>"},{"location":"Hypervision/Proxmox/proxmox/#etape-7-connectez-vous-a-linterface-web","title":"\ud83c\udf10 \u00c9tape 7 : Connectez-vous \u00e0 l'interface web","text":"<p>Acc\u00e9dez \u00e0 l'interface web de Proxmox VE : https://votre-ip:8006</p> <ul> <li>Identifiant : <code>root</code></li> <li>Authentification : PAM</li> </ul>"},{"location":"Hypervision/Proxmox/proxmox/#etape-8-script-de-post-installation","title":"\u2699\ufe0f \u00c9tape 8 : Script de post-installation","text":"<p>Pour simplifier la configuration, ex\u00e9cutez le script de post-installation recommand\u00e9 :</p> <pre><code>bash -c \"$(wget -qLO - https://github.com/tteck/Proxmox/raw/main/misc/post-pve-install.sh)\"\n</code></pre> <p>Ensuite, supprimez le d\u00e9p\u00f4t \"no-subscription\" :</p> <pre><code>rm /etc/apt/sources.list.d/pve-install-repo.list\n</code></pre>"},{"location":"Hypervision/Proxmox/proxmox/#conclusion","title":"\ud83d\udcda Conclusion","text":"<p>Vous avez install\u00e9 et configur\u00e9 Proxmox VE avec succ\u00e8s. Explorez les fonctionnalit\u00e9s via l'interface web pour g\u00e9rer vos machines virtuelles et conteneurs efficacement. \ud83c\udf89</p>"},{"location":"Hypervision/Proxmox/storagepxiso/","title":"\ud83d\udee0\ufe0f Configurer un Volume Logique pour Stocker des ISO et Mod\u00e8les de Conteneurs","text":""},{"location":"Hypervision/Proxmox/storagepxiso/#objectif","title":"\ud83d\udccb Objectif","text":"<p>Dans ce guide, nous allons expliquer comment nous avons configur\u00e9 un Logical Volume ISOC-LVM de 50 Go pour stocker les fichiers ISO et les mod\u00e8les de conteneurs dans Proxmox. Ce volume a \u00e9t\u00e9 mont\u00e9 sur <code>/mnt/ISOC-LVM/</code> et organis\u00e9 en deux r\u00e9pertoires : Iso-Storage et Container-Templates.</p>"},{"location":"Hypervision/Proxmox/storagepxiso/#etape-1-creation-du-logical-volume-isoc-lvm","title":"\ud83d\udcc2 \u00c9tape 1 : Cr\u00e9ation du Logical Volume ISOC-LVM","text":"<p>Nous avons commenc\u00e9 par cr\u00e9er un Logical Volume de 50 Go dans notre Volume Group VGVMs. Voici la commande utilis\u00e9e :</p> <pre><code>sudo lvcreate -L 50G -n ISOC-LVM VGVMs\n</code></pre>"},{"location":"Hypervision/Proxmox/storagepxiso/#verification-de-la-creation","title":"V\u00e9rification de la cr\u00e9ation :","text":"<p>Apr\u00e8s la cr\u00e9ation, nous avons v\u00e9rifi\u00e9 la liste des Logical Volumes avec :</p> <pre><code>sudo lvs\n</code></pre>"},{"location":"Hypervision/Proxmox/storagepxiso/#exemple-de-sortie","title":"Exemple de sortie :","text":"<pre>\nLV          VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\nISOC-LVM    VGVMs  -wi-a-----  50.00g\n</pre>"},{"location":"Hypervision/Proxmox/storagepxiso/#etape-2-formatage-et-montage-du-volume","title":"\ud83c\udf0a \u00c9tape 2 : Formatage et Montage du Volume","text":"<p>Nous avons format\u00e9 le volume avec un syst\u00e8me de fichiers ext4 pour y stocker nos fichiers.</p>"},{"location":"Hypervision/Proxmox/storagepxiso/#formatage","title":"Formatage :","text":"<pre><code>sudo mkfs.ext4 /dev/VGVMs/ISOC-LVM\n</code></pre>"},{"location":"Hypervision/Proxmox/storagepxiso/#creation-du-point-de-montage","title":"Cr\u00e9ation du point de montage :","text":"<p>Nous avons cr\u00e9\u00e9 le r\u00e9pertoire de montage <code>/mnt/ISOC-LVM/</code> :</p> <pre><code>sudo mkdir -p /mnt/ISOC-LVM\n</code></pre>"},{"location":"Hypervision/Proxmox/storagepxiso/#montage-du-volume","title":"Montage du volume :","text":"<p>Ensuite, nous avons mont\u00e9 le Logical Volume \u00e0 cet emplacement :</p> <pre><code>sudo mount /dev/VGVMs/ISOC-LVM /mnt/ISOC-LVM\n</code></pre>"},{"location":"Hypervision/Proxmox/storagepxiso/#rendre-le-montage-permanent","title":"Rendre le montage permanent :","text":"<p>Pour que le montage soit automatique au red\u00e9marrage, nous avons ajout\u00e9 une entr\u00e9e dans <code>/etc/fstab</code> :</p> <pre><code>sudo nano /etc/fstab\n</code></pre> <p>Nous avons ajout\u00e9 la ligne suivante \u00e0 la fin du fichier :</p> <pre><code>/dev/VGVMs/ISOC-LVM  /mnt/ISOC-LVM  ext4  defaults  0  2\n</code></pre> <p>Nous avons ensuite test\u00e9 la configuration avec :</p> <pre><code>sudo mount -a\n</code></pre>"},{"location":"Hypervision/Proxmox/storagepxiso/#etape-3-organisation-des-repertoires","title":"\ud83d\udee0\ufe0f \u00c9tape 3 : Organisation des R\u00e9pertoires","text":"<p>\u00c0 partir de l\u2019interface web Proxmox, nous avons cr\u00e9\u00e9 deux r\u00e9pertoires directement dans <code>/mnt/ISOC-LVM/</code> pour organiser le stockage :</p> <ul> <li>Iso-Storage : pour stocker les fichiers ISO.</li> <li>Container-Templates : pour stocker les mod\u00e8les de conteneurs.</li> </ul>"},{"location":"Hypervision/Proxmox/storagepxiso/#structure-finale","title":"Structure finale :","text":"<p>Voici la structure du montage :</p> <pre><code>/mnt/ISOC-LVM/\n\u251c\u2500\u2500 Iso-Storage\n\u2514\u2500\u2500 Container-Templates\n</code></pre>"},{"location":"Hypervision/Proxmox/storagepxiso/#etape-4-configuration-dans-proxmox","title":"\ud83d\udda5\ufe0f \u00c9tape 4 : Configuration dans Proxmox","text":"<p>Nous avons ajout\u00e9 ces deux r\u00e9pertoires comme stockages s\u00e9par\u00e9s dans Proxmox.</p> <ol> <li>Dans l\u2019interface web de Proxmox, nous sommes all\u00e9s dans Datacenter \u2192 Storage \u2192 Add \u2192 Directory.</li> <li>Nous avons ajout\u00e9 Iso-Storage :</li> <li>ID : Iso-Storage</li> <li>Directory : <code>/mnt/ISOC-LVM/Iso-Storage</code></li> <li>Content : ISO image</li> <li>Nous avons ajout\u00e9 Container-Templates :</li> <li>ID : Container-Templates</li> <li>Directory : <code>/mnt/ISOC-LVM/Container-Templates</code></li> <li>Content : Container template</li> </ol>"},{"location":"Hypervision/Proxmox/storagepxiso/#etape-5-verification-et-utilisation","title":"\ud83d\udcc2 \u00c9tape 5 : V\u00e9rification et Utilisation","text":""},{"location":"Hypervision/Proxmox/storagepxiso/#verification","title":"V\u00e9rification :","text":"<p>Nous avons v\u00e9rifi\u00e9 que les deux stockages apparaissent dans l'interface web sous Datacenter \u2192 Storage et qu\u2019ils acceptent les types de contenu appropri\u00e9s (ISO et mod\u00e8les de conteneurs).</p>"},{"location":"Hypervision/Proxmox/storagepxiso/#test","title":"Test :","text":"<ul> <li>Nous avons t\u00e9l\u00e9charg\u00e9 un fichier ISO dans Iso-Storage.</li> <li>Nous avons ajout\u00e9 un mod\u00e8le de conteneur dans Container-Templates.</li> </ul>"},{"location":"Hypervision/Proxmox/storagepxiso/#conclusion","title":"\ud83d\udcda Conclusion","text":"<p>Nous avons configur\u00e9 ISOC-LVM pour stocker les ISO et mod\u00e8les de conteneurs dans Proxmox. Cette configuration permet de s\u00e9parer clairement les types de contenu et de maintenir une structure bien organis\u00e9e. Nous pouvons maintenant utiliser ces r\u00e9pertoires pour g\u00e9rer efficacement nos fichiers ISO et mod\u00e8les dans Proxmox.</p>"},{"location":"Hypervision/Proxmox/zfsproxmox/","title":"\ud83d\udee0\ufe0f Configurer et Tester un Pool ZFS dans Proxmox","text":""},{"location":"Hypervision/Proxmox/zfsproxmox/#objectif","title":"\ud83d\udccb Objectif","text":"<p>Dans ce guide, nous allons configurer un pool ZFS dans Proxmox en utilisant un Logical Volume (LV) de 100 Go provenant de notre Volume Group (VGVMs). Nous int\u00e9grerons \u00e9galement le pool VM-ZFS dans Proxmox pour g\u00e9rer le stockage.</p>"},{"location":"Hypervision/Proxmox/zfsproxmox/#etape-1-verifions-lespace-disponible-dans-le-volume-group","title":"\ud83d\udcc2 \u00c9tape 1 : V\u00e9rifions l'espace disponible dans le Volume Group","text":"<p>Avant de cr\u00e9er un Logical Volume pour ZFS, v\u00e9rifions l'espace libre dans le VG VGVMs :</p> <pre><code>sudo vgs\n</code></pre>"},{"location":"Hypervision/Proxmox/zfsproxmox/#exemple-de-sortie","title":"Exemple de sortie :","text":"<pre>\nVG     #PV #LV #SN Attr   VSize   VFree  \nVGVMs    1  10   0 wz--n- 372.5g  120.0g\n</pre> <ul> <li>VFree montre l'espace disponible. Assurons-nous qu'il est sup\u00e9rieur \u00e0 100 Go pour notre test.</li> </ul>"},{"location":"Hypervision/Proxmox/zfsproxmox/#etape-2-creons-un-volume-logique-pour-zfs","title":"\ud83e\uddf1 \u00c9tape 2 : Cr\u00e9ons un volume logique pour ZFS","text":"<p>Utilisons l'espace libre pour cr\u00e9er un volume logique de 100 Go dans le Volume Group VGVMs :</p> <pre><code>sudo lvcreate -L 100G -n VM-ZFS VGVMs\n</code></pre>"},{"location":"Hypervision/Proxmox/zfsproxmox/#verifions-la-creation","title":"V\u00e9rifions la cr\u00e9ation :","text":"<pre><code>sudo lvs\n</code></pre>"},{"location":"Hypervision/Proxmox/zfsproxmox/#exemple-de-sortie_1","title":"Exemple de sortie :","text":"<pre>\nLV          VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\nVM-ZFS      VGVMs  -wi-a----- 100.00g\n</pre>"},{"location":"Hypervision/Proxmox/zfsproxmox/#etape-3-initialisons-un-pool-zfs","title":"\ud83c\udf0a \u00c9tape 3 : Initialisons un pool ZFS","text":"<p>Transformons le volume logique en un nouveau pool ZFS nomm\u00e9 VM-ZFS :</p> <pre><code>sudo zpool create VM-ZFS /dev/VGVMs/VM-ZFS\n</code></pre>"},{"location":"Hypervision/Proxmox/zfsproxmox/#verifions-la-creation-du-pool-zfs","title":"V\u00e9rifions la cr\u00e9ation du pool ZFS :","text":"<pre><code>sudo zpool list\n</code></pre>"},{"location":"Hypervision/Proxmox/zfsproxmox/#exemple-de-sortie_2","title":"Exemple de sortie :","text":"<pre>\nNAME       SIZE  ALLOC   FREE  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT\nVM-ZFS     100G   0B     100G       -        0%     0%  1.00x  ONLINE  -\n</pre>"},{"location":"Hypervision/Proxmox/zfsproxmox/#etape-4-ajoutons-le-pool-zfs-dans-proxmox","title":"\ud83d\udee0\ufe0f \u00c9tape 4 : Ajoutons le pool ZFS dans Proxmox","text":"<p>Ajoutons le pool ZFS dans la configuration de Proxmox.</p> <ol> <li> <p>Ouvrons le fichier de configuration : <pre><code>   sudo nano /etc/pve/storage.cfg\n</code></pre></p> </li> <li> <p>Ajoutons le bloc suivant pour le pool VM-ZFS : <pre><code>   zfspool: VM-ZFS\n       pool VM-ZFS\n       content rootdir,images\n       sparse\n</code></pre></p> </li> <li> <p>Red\u00e9marrons les services Proxmox pour appliquer les changements : <pre><code>   sudo systemctl restart pvedaemon pveproxy\n</code></pre></p> </li> </ol>"},{"location":"Hypervision/Proxmox/zfsproxmox/#etape-5-verifions-dans-linterface-web","title":"\ud83d\udda5\ufe0f \u00c9tape 5 : V\u00e9rifions dans l'interface web","text":"<ol> <li>Connectons-nous \u00e0 l'interface web de Proxmox.</li> <li>Allons dans Datacenter \u2192 Storage.</li> <li>V\u00e9rifions que le stockage VM-ZFS est bien disponible.</li> <li>Essayons de cr\u00e9er une VM ou un conteneur en utilisant ce stockage.</li> </ol>"},{"location":"Hypervision/Proxmox/zfsproxmox/#etape-6-verifions-le-thin-provisioning","title":"\ud83d\udd0d \u00c9tape 6 : V\u00e9rifions le Thin Provisioning","text":"<ol> <li>Affichons les propri\u00e9t\u00e9s du pool ZFS : <pre><code>   zfs get all VM-ZFS\n</code></pre></li> </ol> <p>Cherchons les lignes suivantes :</p> <pre>\n   NAME       PROPERTY        VALUE      SOURCE\n   VM-ZFS     reservation     none       default\n</pre> <ul> <li> <p><code>reservation=none</code> indique que le thin provisioning est activ\u00e9.</p> </li> <li> <p>Si nous avons cr\u00e9\u00e9 un volume pour une VM, affichons ses propri\u00e9t\u00e9s : <pre><code>   zfs get volsize,refreservation,reservation VM-ZFS/vm-106-disk-0\n</code></pre></p> </li> </ul> <p>Exemple de sortie :</p> <pre>\n   NAME                   PROPERTY        VALUE      SOURCE\n   VM-ZFS/vm-106-disk-0   volsize         50G        local\n   VM-ZFS/vm-106-disk-0   refreservation  none       local\n   VM-ZFS/vm-106-disk-0   reservation     none       default\n</pre> <ul> <li><code>refreservation=none</code> confirme le thin provisioning.</li> </ul>"},{"location":"Hypervision/Proxmox/zfsproxmox/#etape-7-nettoyons-apres-le-test-optionnel","title":"\ud83e\uddf9 \u00c9tape 7 : Nettoyons apr\u00e8s le test (optionnel)","text":"<p>Si nous n'avons plus besoin du test, supprimons le pool ZFS et le volume logique.</p> <ol> <li> <p>D\u00e9truisons le pool ZFS : <pre><code>   sudo zpool destroy VM-ZFS\n</code></pre></p> </li> <li> <p>Supprimons le volume logique : <pre><code>   sudo lvremove /dev/VGVMs/VM-ZFS\n</code></pre></p> </li> </ol>"},{"location":"Hypervision/Proxmox/zfsproxmox/#conclusion","title":"\ud83d\udcda Conclusion","text":"<p>Nous avons configur\u00e9 et test\u00e9 VM-ZFS dans Proxmox en utilisant un espace d\u00e9di\u00e9 dans VGVMs. Cette configuration nous permet de b\u00e9n\u00e9ficier des fonctionnalit\u00e9s avanc\u00e9es de ZFS, telles que :</p> <ul> <li>Snapshots natifs.</li> <li>Clonage rapide.</li> <li>Thin provisioning.</li> <li>Compression int\u00e9gr\u00e9e.</li> </ul> <p>Nous pouvons maintenant utiliser VM-ZFS comme pool de stockage principal dans Proxmox pour nos VM et conteneurs.</p>"},{"location":"Secu/https/","title":"Activer HTTPS avec une Autorit\u00e9 de Certification personnalis\u00e9e sur <code>tours.sportludique.fr</code>","text":"<p>Ce guide explique comment g\u00e9n\u00e9rer un certificat SSL sign\u00e9 par une autorit\u00e9 interne, l\u2019installer et le configurer pour le site <code>tours.sportludique.fr</code>.</p> <p>Ce certificat est utilis\u00e9 dans le cadre du site web vitrine de SportLudique, h\u00e9berg\u00e9 localement et expos\u00e9 publiquement via un reverse proxy HAProxy, dont la configuration est abord\u00e9e dans la section Haute-disponibilit\u00e9.</p>"},{"location":"Secu/https/#etape-1-recuperation-du-certificat-dautorite","title":"\u00c9tape 1 \u2013 R\u00e9cup\u00e9ration du certificat d\u2019autorit\u00e9","text":"<p>Avant toute configuration, il est n\u00e9cessaire que le client (navigateur) fasse confiance \u00e0 l\u2019autorit\u00e9 interne STS Root R2.</p> <p>T\u00e9l\u00e9chargez le certificat racine depuis : https://trustus.mana.lan/ca.crt</p> <p>Puis, installez ce fichier dans le magasin de certificats de confiance de votre navigateur ou de votre OS.</p>"},{"location":"Secu/https/#etape-2-generation-du-certificat-ssl-pour-tourssportludiquefr","title":"\u00c9tape 2 \u2013 G\u00e9n\u00e9ration du certificat SSL pour <code>tours.sportludique.fr</code>","text":"<ol> <li>Cr\u00e9er une cl\u00e9 priv\u00e9e pour le site :</li> </ol> <pre><code>openssl genrsa -out tours.sportludique.fr.key 2048\n</code></pre> <ol> <li>Cr\u00e9er un fichier de configuration OpenSSL (ex : <code>tours.sportludique.fr.conf</code>) :</li> </ol> <pre><code>[req]\ndefault_bits       = 2048\nprompt             = no\ndefault_md         = sha256\ndistinguished_name = dn\nreq_extensions     = req_ext\n\n[dn]\nCN = tours.sportludique.fr\n\n[req_ext]\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1 = tours.sportludique.fr\n</code></pre> <ol> <li>G\u00e9n\u00e9rer la CSR :</li> </ol> <pre><code>openssl req -new -key tours.sportludique.fr.key \\\n  -out tours.sportludique.fr.csr \\\n  -config tours.sportludique.fr.conf\n</code></pre> <ol> <li>Signer la CSR avec la CA STS Root R2 :</li> </ol> <p>(Depuis la machine qui h\u00e9berge la CA)</p> <pre><code>openssl x509 -req \\\n  -in tours.sportludique.fr.csr \\\n  -CA /etc/ssl/STS-Root-R2/certs/ca.crt \\\n  -CAkey /etc/ssl/STS-Root-R2/private/ca.key \\\n  -CAcreateserial \\\n  -out tours.sportludique.fr.crt \\\n  -days 365 \\\n  -sha256 \\\n  -extfile tours.sportludique.fr.conf \\\n  -extensions req_ext\n</code></pre>"},{"location":"Secu/https/#etape-3-deploiement-avec-apache-en-local","title":"\u00c9tape 3 \u2013 D\u00e9ploiement avec Apache (en local)","text":"<ol> <li>D\u00e9placer les fichiers dans les emplacements standards :</li> </ol> <pre><code>sudo cp tours.sportludique.fr.crt /etc/ssl/certs/\nsudo cp tours.sportludique.fr.key /etc/ssl/private/\n</code></pre> <ol> <li>Cr\u00e9er un fichier Apache dans <code>/etc/apache2/sites-available/tours.sportludique.fr.conf</code> :</li> </ol> <pre><code>&lt;VirtualHost *:443&gt;\n    ServerName tours.sportludique.fr\n    DocumentRoot /var/www/html/sportludique_parodie\n\n    SSLEngine on\n    SSLCertificateFile /etc/ssl/certs/tours.sportludique.fr.crt\n    SSLCertificateKeyFile /etc/ssl/private/tours.sportludique.fr.key\n\n    &lt;Directory /var/www/html/sportludique_parodie&gt;\n        AllowOverride All\n        Require all granted\n    &lt;/Directory&gt;\n&lt;/VirtualHost&gt;\n</code></pre> <ol> <li>Activer le module SSL et le site :</li> </ol> <pre><code>sudo a2enmod ssl\nsudo a2ensite tours.sportludique.fr\nsudo systemctl restart apache2\n</code></pre>"},{"location":"Secu/https/#etape-4-integration-avec-le-reverse-proxy-haproxy","title":"\u00c9tape 4 \u2013 Int\u00e9gration avec le reverse proxy HAProxy","text":"<p>Dans l\u2019environnement final, le site <code>tours.sportludique.fr</code> est servi via HAProxy, qui se charge de la terminaison TLS et de la redirection vers l\u2019Apache local.</p> <p>La configuration de HAProxy est d\u00e9crite dans la page suivante : \u27a1\ufe0f Voir la configuration HAProxy</p> <p>Le certificat <code>.crt</code> peut \u00eatre concat\u00e9n\u00e9 avec sa cl\u00e9 <code>.key</code> pour HAProxy si besoin :</p> <pre><code>cat /etc/ssl/certs/tours.sportludique.fr.crt /etc/ssl/private/tours.sportludique.fr.key &gt; /etc/ssl/haproxy/tours.bundle.pem\n</code></pre>"},{"location":"Secu/https/#etape-5-import-manuel-du-certificat-pour-tests","title":"\u00c9tape 5 \u2013 Import manuel du certificat pour tests","text":"<p>Pour tester l'acc\u00e8s HTTPS depuis un navigateur en interne sans erreur de s\u00e9curit\u00e9 :</p> <ol> <li>Ouvrir <code>https://tours.sportludique.fr</code> depuis le r\u00e9seau local.</li> <li>Si votre navigateur affiche une alerte, installer manuellement le certificat <code>ca.crt</code> depuis <code>https://trustus.mana.lan/</code>.</li> </ol>"},{"location":"Secu/pki/01-creation-ca/","title":"Cr\u00e9ation de l'autorit\u00e9 de certification STS Root R2","text":""},{"location":"Secu/pki/01-creation-ca/#objectif","title":"Objectif","text":"<p>Mettre en place une autorit\u00e9 de certification (CA) locale nomm\u00e9e STS Root R2 dans le but de signer les certificats des serveurs internes de SportLudique. Cette CA repose sur une cl\u00e9 elliptique <code>prime256v1</code>, auto-sign\u00e9e, avec une structure de fichiers compatible avec OpenSSL.</p>"},{"location":"Secu/pki/01-creation-ca/#1-arborescence-de-la-ca","title":"1. Arborescence de la CA","text":"<p>L\u2019infrastructure de la CA est stock\u00e9e dans le dossier : <code>/etc/ssl/STS-Root-R2</code></p> <p>Structure minimale \u00e0 cr\u00e9er :</p> <pre><code>/etc/ssl/STS-Root-R2/\n\u251c\u2500\u2500 certs/           # Contient le certificat public de la CA (ca.crt)\n\u251c\u2500\u2500 private/         # Contient la cl\u00e9 priv\u00e9e de la CA (ca.key)\n\u251c\u2500\u2500 crl/             # Liste des certificats r\u00e9voqu\u00e9s (\u00e0 venir)\n\u251c\u2500\u2500 newcerts/        # Stocke tous les certificats sign\u00e9s\n\u251c\u2500\u2500 index.txt        # Base de donn\u00e9es des certificats\n\u251c\u2500\u2500 serial           # Compteur pour num\u00e9ro de s\u00e9rie\n\u251c\u2500\u2500 openssl.cnf      # Configuration OpenSSL sp\u00e9cifique\n````\n\nInitialisation des fichiers n\u00e9cessaires :\n\n```bash\nsudo mkdir -p /etc/ssl/STS-Root-R2/{certs,crl,newcerts,private}\nsudo touch /etc/ssl/STS-Root-R2/index.txt\necho 1000 | sudo tee /etc/ssl/STS-Root-R2/serial\n</code></pre>"},{"location":"Secu/pki/01-creation-ca/#2-generation-de-la-cle-privee-de-la-ca","title":"2. G\u00e9n\u00e9ration de la cl\u00e9 priv\u00e9e de la CA","text":"<p>La cl\u00e9 priv\u00e9e est une cl\u00e9 elliptique bas\u00e9e sur la courbe <code>prime256v1</code> :</p> <pre><code>openssl ecparam -name prime256v1 -genkey -noout -out /etc/ssl/STS-Root-R2/private/ca.key\nchmod 600 /etc/ssl/STS-Root-R2/private/ca.key\n</code></pre>"},{"location":"Secu/pki/01-creation-ca/#3-signature-du-certificat-auto-signe","title":"3. Signature du certificat auto-sign\u00e9","text":"<p>Cr\u00e9ation d\u2019un certificat valide pour 10 ans (3650 jours) :</p> <pre><code>openssl req -x509 -new -nodes \\\n  -key /etc/ssl/STS-Root-R2/private/ca.key \\\n  -sha256 -days 3650 \\\n  -subj \"/C=FR/ST=Centre-Val-de-Loire/L=Tours/O=SportLudique Trust Services/OU=IT-Departement/CN=STS Root R2\" \\\n  -out /etc/ssl/STS-Root-R2/certs/ca.crt\n</code></pre>"},{"location":"Secu/pki/01-creation-ca/#4-configuration-dopenssl-opensslcnf","title":"4. Configuration d\u2019OpenSSL (openssl.cnf)","text":"<p>Voici un exemple de configuration simplifi\u00e9e, sans CRL ni OCSP (pour cette premi\u00e8re \u00e9tape) :</p> <pre><code>[ ca ]\ndefault_ca = CA_default\n\n[ CA_default ]\ndir             = /etc/ssl/STS-Root-R2\ncerts           = $dir/certs\ncrl_dir         = $dir/crl\ndatabase        = $dir/index.txt\nnew_certs_dir   = $dir/newcerts\ncertificate     = $dir/certs/ca.crt\nserial          = $dir/serial\nprivate_key     = $dir/private/ca.key\ndefault_md      = sha256\ndefault_days    = 825\npolicy          = policy_match\nx509_extensions = v3_ca\ncopy_extensions = copy\n\n[ policy_match ]\ncountryName             = optional\nstateOrProvinceName     = optional\norganizationName        = optional\norganizationalUnitName  = optional\ncommonName              = supplied\nemailAddress            = optional\n\n[ v3_ca ]\nsubjectKeyIdentifier = hash\nauthorityKeyIdentifier = keyid:always,issuer\nbasicConstraints = critical, CA:true, pathlen:0\nkeyUsage = critical, digitalSignature, cRLSign, keyCertSign\n</code></pre>"},{"location":"Secu/pki/01-creation-ca/#5-resultat","title":"5. R\u00e9sultat","text":"<p>Le certificat de l\u2019autorit\u00e9 STS Root R2 est maintenant op\u00e9rationnel :</p> <ul> <li>Cl\u00e9 priv\u00e9e : <code>/etc/ssl/STS-Root-R2/private/ca.key</code></li> <li>Certificat public : <code>/etc/ssl/STS-Root-R2/certs/ca.crt</code></li> <li>Peut d\u00e9sormais signer des certificats serveurs (FQDN, Wildcard ou Interm\u00e9diaires)</li> </ul>"},{"location":"Secu/pki/01-creation-ca/#etapes-suivantes","title":"\u00c9tapes suivantes","text":"<ul> <li>Publication du certificat racine (installation sur les postes clients)</li> <li>Configuration OCSP et CRL</li> <li>G\u00e9n\u00e9ration de certificats serveur via scripts automatis\u00e9s</li> </ul> <p>Ce certificat racine auto-sign\u00e9 doit \u00eatre import\u00e9 manuellement dans les navigateurs et syst\u00e8mes clients de l\u2019entreprise pour \u00eatre reconnu comme de confiance.</p>"},{"location":"Secu/pki/02-certificats-signature-manuelle/","title":"Signature manuelle de certificats (FQDN et Wildcard)","text":"<p>Dans cette \u00e9tape, nous verrons comment g\u00e9n\u00e9rer un certificat TLS pour un site web ou un service interne. Cette proc\u00e9dure est destin\u00e9e aux cas o\u00f9 un certificat sp\u00e9cifique est n\u00e9cessaire (nom de domaine unique ou wildcard).</p>"},{"location":"Secu/pki/02-certificats-signature-manuelle/#recommandations","title":"Recommandations","text":"<ul> <li>Ne jamais manipuler directement les fichiers dans <code>/etc/ssl/STS-Root-R2</code> (r\u00e9pertoire de la CA).</li> <li>Les certificats utilisateurs (cl\u00e9 priv\u00e9e, CSR, certificat sign\u00e9) doivent \u00eatre g\u00e9n\u00e9r\u00e9s dans un dossier personnel, par exemple :   <code>/home/toursadmin/STS-Root-R2/Client/</code>.</li> <li>Le CN (Common Name) seul ne suffit plus. Depuis la RFC 2818, le champ <code>subjectAltName</code> est obligatoire.</li> </ul>"},{"location":"Secu/pki/02-certificats-signature-manuelle/#exemple-de-generation-pour-un-certificat-fqdn","title":"Exemple de g\u00e9n\u00e9ration pour un certificat FQDN","text":"<pre><code>mkdir -p ~/STS-Root-R2/Client/monserveur.mana.lan\ncd ~/STS-Root-R2/Client/monserveur.mana.lan\n\n# Cl\u00e9 ECC en prime256v1 (standard recommand\u00e9)\nopenssl ecparam -name prime256v1 -genkey -noout -out privkey.key\n\n# G\u00e9n\u00e9ration d'une CSR (remplir CN, OU, O, etc.)\nopenssl req -new -key privkey.key -out request.csr \\\n  -subj \"/C=FR/ST=Centre-Val-de-Loire/L=Tours/O=SportLudique/OU=IT-Departement/CN=monserveur.mana.lan\"\n\n# Fichier d'extensions avec subjectAltName obligatoire\ncat &gt; extfile.cnf &lt;&lt;EOF\nsubjectAltName = DNS:monserveur.mana.lan\nkeyUsage = digitalSignature, keyEncipherment\nextendedKeyUsage = serverAuth\nEOF\n</code></pre>"},{"location":"Secu/pki/02-certificats-signature-manuelle/#signature-du-certificat-par-la-ca","title":"Signature du certificat par la CA","text":"<pre><code>sudo openssl ca -in request.csr -out cert.crt \\\n  -config /etc/ssl/STS-Root-R2/openssl.cnf \\\n  -extensions v3_usr \\\n  -extfile extfile.cnf\n</code></pre> <p>Le fichier <code>index.txt</code> dans la CA enregistre automatiquement le certificat sign\u00e9 et son num\u00e9ro de s\u00e9rie.</p>"},{"location":"Secu/pki/02-certificats-signature-manuelle/#exemple-pour-un-certificat-wildcard","title":"Exemple pour un certificat Wildcard","text":"<pre><code># CN = *.domaine.lan\nopenssl req -new -key privkey.key -out request.csr \\\n  -subj \"/C=FR/ST=Centre-Val-de-Loire/L=Tours/O=SportLudique/OU=IT-Departement/CN=*.domaine.lan\"\n\ncat &gt; extfile.cnf &lt;&lt;EOF\nsubjectAltName = DNS:*.domaine.lan, DNS:domaine.lan\nkeyUsage = digitalSignature, keyEncipherment\nextendedKeyUsage = serverAuth\nEOF\n</code></pre>"},{"location":"Secu/pki/02-certificats-signature-manuelle/#organisation-recommandee","title":"Organisation recommand\u00e9e","text":"<pre><code>~/STS-Root-R2/Client/\n\u251c\u2500\u2500 monserveur.mana.lan/\n\u2502   \u251c\u2500\u2500 privkey.key\n\u2502   \u251c\u2500\u2500 request.csr\n\u2502   \u251c\u2500\u2500 cert.crt\n\u2502   \u2514\u2500\u2500 extfile.cnf\n\u2514\u2500\u2500 wildcard.domaine.lan/\n    \u2514\u2500\u2500 ...\n</code></pre> <p>Remarque : la CRL et OCSP ne sont pas encore int\u00e9gr\u00e9s \u00e0 cette \u00e9tape. Ils sont abord\u00e9s dans les parties suivantes.</p>"},{"location":"Secu/pki/03-automatisation-signature/","title":"Automatisation de la g\u00e9n\u00e9ration et de la signature des certificats","text":"<p>Dans un objectif de standardisation et de s\u00e9curit\u00e9, la DSI de SportLudique a mis en place un syst\u00e8me automatis\u00e9 pour la gestion des certificats SSL. Cette solution repose sur un script principal interactif accompagn\u00e9 de scripts d\u00e9di\u00e9s \u00e0 diff\u00e9rents types de certificats.</p> <p>Tous les fichiers sensibles de l\u2019autorit\u00e9 de certification (CA) sont strictement localis\u00e9s dans :</p> <pre><code>/etc/ssl/STS-Root-R2\n</code></pre>"},{"location":"Secu/pki/03-automatisation-signature/#objectifs","title":"Objectifs","text":"<ul> <li>Automatiser la g\u00e9n\u00e9ration des cl\u00e9s priv\u00e9es et des demandes de certificats (CSR)</li> <li>Signer automatiquement les certificats avec la CA STS Root R2</li> <li>Isoler les fichiers utilisateurs dans un r\u00e9pertoire s\u00e9curis\u00e9 d\u00e9di\u00e9</li> </ul>"},{"location":"Secu/pki/03-automatisation-signature/#structure-du-projet","title":"Structure du projet","text":"<pre><code>~/STS-Root-R2/\n\u251c\u2500\u2500 csr-et-signe-sts.sh       \u2190 Script principal (menu interactif)\n\u2514\u2500\u2500 Scripts/\n    \u251c\u2500\u2500 gen-fqdn.sh           \u2190 Certificats FQDN\n    \u251c\u2500\u2500 gen-wildcard.sh       \u2190 Certificats wildcard\n    \u2514\u2500\u2500 gen-chain.sh          \u2190 Autorit\u00e9s interm\u00e9diaires\n</code></pre>"},{"location":"Secu/pki/03-automatisation-signature/#script-principal-csr-et-signe-stssh","title":"Script principal : <code>csr-et-signe-sts.sh</code>","text":"<p>Ce script interactif affiche le menu suivant :</p> <pre><code>STS Root R2 \u2013 Menu de g\u00e9n\u00e9ration de certificats\n-----------------------------------------------\n1. G\u00e9n\u00e9rer un certificat FQDN\n2. G\u00e9n\u00e9rer un certificat Wildcard\n3. G\u00e9n\u00e9rer un certificat d'autorit\u00e9 interm\u00e9diaire\n0. Quitter\n</code></pre> <p>Chaque option appelle un script sp\u00e9cifique d\u00e9taill\u00e9 ci-dessous.</p>"},{"location":"Secu/pki/03-automatisation-signature/#detail-des-scripts","title":"D\u00e9tail des scripts","text":""},{"location":"Secu/pki/03-automatisation-signature/#gen-fqdnsh-certificat-fqdn","title":"<code>gen-fqdn.sh</code> \u2013 Certificat FQDN","text":"<p>Ce script permet de g\u00e9n\u00e9rer un certificat standard pour un nom de domaine complet (FQDN).</p> <p>Fonctionnalit\u00e9s :</p> <ul> <li>G\u00e9n\u00e9ration d\u2019une cl\u00e9 ECC (<code>prime256v1</code>)</li> <li>Saisie interactive des informations du CSR</li> <li>Ajout optionnel de SAN</li> <li>Signature automatique via <code>openssl ca</code></li> <li>Fichiers g\u00e9n\u00e9r\u00e9s dans :</li> </ul> <pre><code>~/STS-Root-R2/Client/&lt;domaine&gt;/\n</code></pre> <p>Lien vers le script : Scripts/gen-fqdn.sh</p>"},{"location":"Secu/pki/03-automatisation-signature/#gen-wildcardsh-certificat-wildcard","title":"<code>gen-wildcard.sh</code> \u2013 Certificat Wildcard","text":"<p>Ce script permet de g\u00e9n\u00e9rer un certificat de type wildcard pour un domaine donn\u00e9.</p> <p>Fonctionnalit\u00e9s :</p> <ul> <li>CN = <code>*.&lt;domaine&gt;</code></li> <li>SAN = <code>DNS:&lt;domaine&gt;, DNS:*.&lt;domaine&gt;</code></li> <li>Cl\u00e9 ECC <code>prime256v1</code></li> <li>Signature automatique via <code>openssl ca</code></li> <li>Fichiers g\u00e9n\u00e9r\u00e9s dans :</li> </ul> <pre><code>~/STS-Root-R2/Client/wildcard_&lt;domaine&gt;/\n</code></pre> <p>Lien vers le script : Scripts/gen-wildcard.sh</p>"},{"location":"Secu/pki/03-automatisation-signature/#gen-chainsh-autorite-intermediaire","title":"<code>gen-chain.sh</code> \u2013 Autorit\u00e9 interm\u00e9diaire","text":"<p>Ce script permet de g\u00e9n\u00e9rer une autorit\u00e9 interm\u00e9diaire sign\u00e9e par STS Root R2.</p> <p>Fonctionnalit\u00e9s :</p> <ul> <li>G\u00e9n\u00e9ration d\u2019une nouvelle autorit\u00e9 avec le profil <code>v3_ca</code></li> <li>CN = FQDN de l\u2019autorit\u00e9 interm\u00e9diaire</li> <li>Fichiers g\u00e9n\u00e9r\u00e9s dans :</li> </ul> <pre><code>~/STS-Root-R2/Client/intermediate_&lt;domaine&gt;/\n</code></pre> <p>Lien vers le script : Scripts/gen-chain.sh</p>"},{"location":"Secu/pki/03-automatisation-signature/#bonnes-pratiques","title":"Bonnes pratiques","text":"<ul> <li>Ne jamais modifier directement les fichiers de la CA principale.</li> <li>Tous les fichiers critiques sont stock\u00e9s dans :</li> </ul> <pre><code>/etc/ssl/STS-Root-R2/\n</code></pre> <ul> <li>Tous les certificats (serveurs, utilisateurs, wildcard, cha\u00eenes) doivent \u00eatre cr\u00e9\u00e9s via les scripts du r\u00e9pertoire :</li> </ul> <pre><code>~/STS-Root-R2/Scripts/\n</code></pre> <p>Aucun script ne modifie les fichiers internes de la CA, sauf lors de la signature via <code>openssl ca</code>.</p>"},{"location":"Secu/pki/03-automatisation-signature/#etape-suivante","title":"\u00c9tape suivante","text":"<p>Consulter : 04 \u2013 Publication de la CRL &amp; Mise en place d\u2019un serveur OCSP</p>"},{"location":"Secu/pki/04-crl-et-ocsp/","title":"Publication de la CRL et mise en place d'un serveur OCSP","text":""},{"location":"Secu/pki/04-crl-et-ocsp/#constat-initial","title":"Constat initial","text":"<p>Au depart, la DSI de SportLudique a propose la mise en place d'une CRL (liste de certificats revoques) accessible via HTTP, hebergee sur le serveur <code>trustus</code>. L'objectif etait de permettre aux clients de verifier si un certificat avait ete revoque, sans connexion directe a l'autorite.</p> <p>Cependant, lors des tests, nous avons constate que ce mecanisme etait lourd, lent et peu adapte aux environnements modernes. De plus, la plupart des navigateurs et clients SSL ne consultent pas toujours la CRL correctement ou de maniere systematique. Ce systeme etait donc considere comme obsolete dans le contexte actuel.</p>"},{"location":"Secu/pki/04-crl-et-ocsp/#evolution-vers-ocsp","title":"Evolution vers OCSP","text":"<p>Apres analyse, la solution retenue a ete de passer a OCSP (Online Certificate Status Protocol), qui permet une verification en ligne de l'etat d'un certificat, de maniere plus rapide et plus fiable.</p> <p>Nous avons configure un serveur OCSP base sur OpenSSL, expose sur <code>http://trustus.mana.lan/ocsp</code> et <code>http://trustus.tours.sportludique.fr/ocsp</code>.</p>"},{"location":"Secu/pki/04-crl-et-ocsp/#configuration-openssl-avant-ocsp","title":"Configuration OpenSSL avant OCSP","text":"<p>Voici un extrait de <code>openssl.cnf</code> avant la mise en place :</p> <pre><code>[ v3_ca ]\nsubjectKeyIdentifier = hash\nauthorityKeyIdentifier = keyid:always,issuer\nbasicConstraints = critical, CA:true, pathlen:0\nkeyUsage = critical, digitalSignature, cRLSign, keyCertSign\n</code></pre>"},{"location":"Secu/pki/04-crl-et-ocsp/#mise-en-place-docsp-et-stapling","title":"Mise en place d\u2019OCSP et stapling","text":"<p>La configuration a ensuite ete amelioree pour inclure les URLs OCSP et CRL directement dans les extensions X.509 des certificats signes :</p> <pre><code>[ v3_ca ]\nsubjectKeyIdentifier = hash\nauthorityKeyIdentifier = keyid:always,issuer\nbasicConstraints = critical, CA:true, pathlen:0\nkeyUsage = critical, digitalSignature, cRLSign, keyCertSign\ncrlDistributionPoints = @crl_urls\nauthorityInfoAccess = @ocsp_urls\n\n[ v3_usr ]\nsubjectKeyIdentifier = hash\nauthorityKeyIdentifier = keyid,issuer\nbasicConstraints = critical, CA:false\nkeyUsage = digitalSignature, keyEncipherment\nextendedKeyUsage = serverAuth\ncrlDistributionPoints = @crl_urls\nauthorityInfoAccess = @ocsp_urls\n\n[ crl_urls ]\nURI.1 = http://trustus.tours.sportludique.fr/crl.pem\nURI.2 = http://trustus.mana.lan/crl.pem\n\n[ ocsp_urls ]\naccessDescription.1 = OCSP;URI:http://trustus.mana.lan/ocsp\naccessDescription.2 = OCSP;URI:http://trustus.tours.sportludique.fr/ocsp\n</code></pre> <p>Le bloc <code>[ v3_usr ]</code> est utilise pour les certificats utilisateurs/serveurs.</p>"},{"location":"Secu/pki/04-crl-et-ocsp/#adaptation-necessaire-des-scripts","title":"Adaptation necessaire des scripts","text":"<p>Malgre la presence des directives <code>authorityInfoAccess</code> et <code>crlDistributionPoints</code> dans le fichier <code>openssl.cnf</code>, elles n\u2019etaient pas toujours prises en compte lors de la signature avec <code>openssl ca</code>.</p> <p>Pour garantir que les URLs soient bien incluses dans les certificats, il a ete necessaire d\u2019ajouter manuellement les lignes correspondantes dans les fichiers d\u2019extensions generes par les scripts (<code>extfile.cnf</code>), notamment :</p> <pre><code>crlDistributionPoints = URI:http://trustus.tours.sportludique.fr/crl.pem,URI:http://trustus.mana.lan/crl.pem\nauthorityInfoAccess = OCSP;URI:http://trustus.mana.lan/ocsp,OCSP;URI:http://trustus.tours.sportludique.fr/ocsp\n</code></pre> <p>Cela concerne notamment les scripts :</p> <ul> <li><code>gen-fqdn.sh</code></li> <li><code>gen-wildcard.sh</code></li> <li><code>gen-chain.sh</code> (si extensions appliquees manuellement)</li> </ul>"},{"location":"Secu/pki/04-crl-et-ocsp/#conclusion","title":"Conclusion","text":"<p>La veritable securisation du systeme passe par l'utilisation :</p> <ul> <li>d'un serveur OCSP local pour verifier les certificats revoques en temps reel</li> <li>de l\u2019agrafage OCSP (OCSP stapling), qui permet au serveur web de fournir directement la reponse OCSP dans la connexion TLS</li> </ul> <p>Grace a cette evolution, les clients obtiennent une preuve d\u2019etats a jour, sans devoir contacter eux-memes le serveur OCSP.</p> <p>\u27a1\ufe0f \u00c9tape suivante : Finalisation de la PKI : exploitation et distribution</p>"},{"location":"Secu/pki/05-finalisation-pki/","title":"Finalisation de la PKI : exploitation, r\u00e9vocation et distribution","text":"<p>Une fois l\u2019OCSP et la configuration des extensions en place, la DSI a finalis\u00e9 la mise en production de l\u2019autorit\u00e9 STS Root R2 avec les composants suivants :</p>"},{"location":"Secu/pki/05-finalisation-pki/#1-mise-en-service-automatique-de-locsp","title":"1. Mise en service automatique de l\u2019OCSP","text":"<p>Pour rendre l\u2019OCSP fiable et persistant, un service <code>systemd</code> a \u00e9t\u00e9 cr\u00e9\u00e9 afin que le r\u00e9solveur OCSP d\u00e9marre automatiquement au boot de la machine.</p>"},{"location":"Secu/pki/05-finalisation-pki/#fichier-etcsystemdsystemocsp-responderservice","title":"Fichier <code>/etc/systemd/system/ocsp-responder.service</code>","text":"<pre><code>[Unit]\nDescription=OCSP Responder for STS Root R2\nAfter=network.target\n\n[Service]\nType=simple\nExecStart=/usr/bin/openssl ocsp \\\n  -port 2560 \\\n  -index /etc/ssl/STS-Root-R2/index.txt \\\n  -rsigner /etc/ssl/STS-Root-R2/certs/ca.crt \\\n  -rkey /etc/ssl/STS-Root-R2/private/ca.key \\\n  -CA /etc/ssl/STS-Root-R2/certs/ca.crt \\\n  -text -timeout 5 -nmin 1\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>"},{"location":"Secu/pki/05-finalisation-pki/#commandes-utiles","title":"Commandes utiles","text":"<pre><code>sudo systemctl daemon-reexec\nsudo systemctl enable ocsp-responder\nsudo systemctl start ocsp-responder\n</code></pre> <p>Le port <code>2560</code> est expose via Nginx en reverse proxy pour offrir l\u2019URL externe <code>http://trustus.mana.lan/ocsp</code>.</p>"},{"location":"Secu/pki/05-finalisation-pki/#2-script-de-revocation-simplifie","title":"2. Script de r\u00e9vocation simplifi\u00e9","text":"<p>Un script shell a \u00e9t\u00e9 cr\u00e9\u00e9 pour faciliter la r\u00e9vocation de certificats en proposant automatiquement les num\u00e9ros de s\u00e9rie disponibles. L\u2019utilisateur entre un num\u00e9ro, confirme, et le certificat est r\u00e9voqu\u00e9 proprement.</p>"},{"location":"Secu/pki/05-finalisation-pki/#exemple-de-logique-du-script-revoke-certsh","title":"Exemple de logique du script <code>revoke-cert.sh</code>","text":"<pre><code>#!/bin/bash\n\nCA_DIR=\"/etc/ssl/STS-Root-R2\"\nINDEX=\"$CA_DIR/index.txt\"\nREVOKED=\"$CA_DIR/crl/revoked.txt\"\n\necho \"Certificats valides disponibles :\"\ngrep 'V' \"$INDEX\" | awk '{print $3}' | nl\n\nread -p \"Entrer le numero de serie a revoquer : \" serial\n\nread -p \"Confirmer la revocation du certificat $serial ? (o/n) : \" confirm\n[[ \"$confirm\" != \"o\" &amp;&amp; \"$confirm\" != \"O\" ]] &amp;&amp; { echo \"Annule.\"; exit 1; }\n\nopenssl ca -config \"$CA_DIR/openssl.cnf\" -revoke \"$CA_DIR/newcerts/$serial.pem\"\nopenssl ca -gencrl -out \"$CA_DIR/crl/crl.pem\" -config \"$CA_DIR/openssl.cnf\"\n\necho \"$serial\" &gt;&gt; \"$REVOKED\"\necho \"Certificat $serial revoque et CRL mise a jour.\"\n</code></pre> <p>Le fichier <code>revoked.txt</code> permet de garder une trace manuelle.</p>"},{"location":"Secu/pki/05-finalisation-pki/#3-distribution-du-certificat-dautorite-via-https","title":"3. Distribution du certificat d'autorite via HTTPS","text":"<p>Pour faciliter l'installation du certificat d'autorite sur les postes clients (surtout ceux hors domaine), une page web HTTPS a ete mise en place sur le serveur <code>trustus</code>.</p> <p>Elle permet de :</p> <ul> <li>Telecharger directement <code>ca.crt</code></li> <li>Consulter la documentation de la PKI</li> <li>Voir l'etat OCSP via un lien de test</li> </ul>"},{"location":"Secu/pki/05-finalisation-pki/#exemple-de-contenu-de-la-page","title":"Exemple de contenu de la page :","text":"<pre><code>&lt;h1&gt;STS Root R2 \u2013 Installation du certificat&lt;/h1&gt;\n&lt;p&gt;Pour faire confiance aux certificats emis par SportLudique, vous pouvez installer le certificat racine suivant :&lt;/p&gt;\n\n&lt;a href=\"https://trustus.mana.lan/ca.crt\" download&gt;T\u00e9l\u00e9charger le certificat d'autorit\u00e9&lt;/a&gt;\n</code></pre> <p>Le fichier <code>ca.crt</code> est place dans <code>/var/www/html/</code> et serti avec un certificat SSL (auto-signe par la meme autorite pour test interne).</p>"},{"location":"Secu/pki/05-finalisation-pki/#4-capture-decran","title":"4. Capture d'ecran","text":"<p>Voici une capture d\u2019ecran de la page web permettant l\u2019installation manuelle du certificat racine :</p> <p></p>"},{"location":"Secu/pki/05-finalisation-pki/#conclusion","title":"Conclusion","text":"<p>Grace a cette finalisation :</p> <ul> <li>Le serveur OCSP fonctionne de maniere automatique et securisee</li> <li>Les certificats peuvent etre revoques rapidement sans erreur</li> <li>Les utilisateurs peuvent installer la confiance manuellement si necessaire</li> <li>L\u2019infrastructure PKI est exploitable et conforme aux standards modernes</li> </ul>"},{"location":"Secu/pki/intro/","title":"Infrastructure PKI de SportLudique","text":""},{"location":"Secu/pki/intro/#introduction","title":"Introduction","text":"<p>Dans le cadre de la s\u00e9curisation des acc\u00e8s HTTPS aux serveurs internes et aux interfaces web d\u2019administration des \u00e9quipements r\u00e9seau, la DSI de SportLudique a d\u00e9cid\u00e9 de remplacer l'ancienne autorit\u00e9 de certification interne (ACG-SL) par une nouvelle autorit\u00e9 plus robuste nomm\u00e9e STS Root R2.</p> <p>Cette migration vise \u00e0 r\u00e9pondre \u00e0 des exigences de s\u00e9curit\u00e9 plus strictes, notamment :</p> <ul> <li>Utilisation de certificats \u00e0 courbe elliptique (ECC) pour des cl\u00e9s plus l\u00e9g\u00e8res et plus s\u00fbres.</li> <li>Standard prime256v1 choisi comme base cryptographique.</li> <li>Int\u00e9gration compl\u00e8te du protocole OCSP pour une v\u00e9rification instantan\u00e9e de la validit\u00e9 des certificats.</li> <li>Meilleure gestion des r\u00e9vocations via CRL et OCSP.</li> <li>Automatisation compl\u00e8te de la g\u00e9n\u00e9ration, la signature, la r\u00e9vocation et le renouvellement des certificats via des scripts personnalis\u00e9s.</li> </ul>"},{"location":"Secu/pki/intro/#objectifs","title":"Objectifs","text":"Objectif Description \ud83d\udd10 Renforcer la s\u00e9curit\u00e9 Certificats ECC, meilleure entropie, v\u00e9rification OCSP \ud83d\udd01 R\u00e9vocation rapide Support CRL + OCSP, publication automatique sur le serveur Trustus \u2699\ufe0f Automatisation G\u00e9n\u00e9ration et gestion via scripts shell (<code>gen-fqdn.sh</code>, <code>revoke-cert.sh</code>) \ud83d\udee1\ufe0f Centralisation Tous les certificats sign\u00e9s par STS Root R2, autorit\u00e9 locale unique \ud83c\udf10 Int\u00e9gration serveur web Int\u00e9gration dans NGINX, OCSP Stapling, publication HTTPS"},{"location":"Secu/pki/intro/#composants-de-linfrastructure","title":"Composants de l'infrastructure","text":"Composant R\u00f4le <code>STS Root R2</code> Autorit\u00e9 de certification principale auto-sign\u00e9e <code>CRL</code> Liste de certificats r\u00e9voqu\u00e9s, publi\u00e9e en HTTP <code>OCSP</code> Service en ligne r\u00e9pondant en temps r\u00e9el sur le statut des certificats <code>NGINX</code> Serveur HTTP+OCSP Stapling pour publication <code>Scripts</code> Automatisation de la g\u00e9n\u00e9ration, r\u00e9vocation, renouvellement"},{"location":"Secu/pki/intro/#courbe-elliptique-prime256v1","title":"Courbe elliptique : <code>prime256v1</code>","text":"<p>Le choix de <code>prime256v1</code> (aussi appel\u00e9e secp256r1) repose sur :</p> <ul> <li>Une cl\u00e9 de 256 bits offrant un bon compromis entre s\u00e9curit\u00e9 et performance.</li> <li>Une adoption large dans les navigateurs et serveurs modernes.</li> <li>Une meilleure efficacit\u00e9 par rapport aux cl\u00e9s RSA de 2048 bits.</li> </ul>"},{"location":"Secu/pki/intro/#schema-logique-de-la-pki","title":"Sch\u00e9ma logique de la PKI","text":"<p>```text                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502     STS Root R2     \u2502                 \u2502 (Autorit\u00e9 Racine)   \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                          \u2502                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502 Certificats ECC \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502  FQDN / Wildcard\u2502             \u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502                        \u2502                        \u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502         \u2502 Publication CRL + OCSP      \u2502         \u2502         \u2502 sur serveur HTTP \"trustus\"  \u2502         \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502                                                \u25bc                                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502    Clients / navigateurs   \u2502                                   \u2502    v\u00e9rifient via OCSP      \u2502                                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 ````</p>"},{"location":"Secu/pki/intro/#automatisation","title":"Automatisation","text":"<p>Tous les processus critiques de la PKI sont enti\u00e8rement automatis\u00e9s :</p> Script Fonction <code>csr-et-signe-sts.sh</code> Menu interactif pour signer FQDN, wildcard, etc <code>gen-fqdn.sh</code> G\u00e9n\u00e9ration d\u2019un certificat avec SAN <code>gen-wildcard.sh</code> G\u00e9n\u00e9ration d\u2019un certificat *.domaine.tld <code>gen-chain.sh</code> Signature d\u2019une autorit\u00e9 interm\u00e9diaire <code>revoke-cert.sh</code> R\u00e9vocation d\u2019un certificat + mise \u00e0 jour CRL <code>renew-cert.sh</code> Renouvellement d\u2019un certificat existant"},{"location":"Secu/pki/intro/#conclusion","title":"Conclusion","text":"<p>L\u2019infrastructure STS Root R2 permet \u00e0 SportLudique de disposer d\u2019une PKI moderne, performante et totalement autonome, capable d\u2019\u00e9mettre, suivre et r\u00e9voquer des certificats de mani\u00e8re s\u00e9curis\u00e9e.</p> <p>Tous les certificats doivent \u00eatre sign\u00e9s par STS Root R2 et install\u00e9s manuellement sur les postes clients pour garantir la reconnaissance des services HTTPS internes.</p>"},{"location":"Telephonie/Telephonie/","title":"Guide de d\u00e9ploiement \u2013 Asterisk\u202f18 &amp; t\u00e9l\u00e9phones Cisco (ToIP)","text":""},{"location":"Telephonie/Telephonie/#1-contexte-telephonie-sur-ip-pour-sportludique","title":"1. Contexte\u00a0: T\u00e9l\u00e9phonie sur IP pour Sportludique","text":"<p>L\u2019entreprise Sportludique a besoin d\u2019assurer une communication rapide et efficace entre ses diff\u00e9rents services sur le site de Tours (Conception, Production, Informatiques). Pour r\u00e9pondre \u00e0 cette exigence de fluidit\u00e9, de fiabilit\u00e9 et d\u2019\u00e9volutivit\u00e9 des \u00e9changes, la mise en place d\u2019une solution de t\u00e9l\u00e9phonie sur IP (ToIP) s\u2019impose.</p> <p>L\u2019entreprise Sportludique vise\u00a0:</p> <ul> <li>la rationalisation des co\u00fbts t\u00e9l\u00e9phoniques\u202f;</li> <li>la mobilit\u00e9 (application\u202fZoiper sur Wi\u2011Fi d\u00e9di\u00e9)\u202f;</li> <li>l\u2019interop\u00e9rabilit\u00e9 entre postes Cisco 79\u00d7\u00d7 et soft\u2011phones\u00a0;</li> <li>la qualit\u00e9 de service (VLAN 125 voix, SSID\u202fToIP, QoS en c\u0153ur).</li> </ul> <p>Le choix s\u2019est port\u00e9 sur Asterisk\u00a018 jouant le r\u00f4le d\u2019IPBX (SIP), install\u00e9 sur une VM Debian, et sur des t\u00e9l\u00e9phones Cisco 7942G migr\u00e9s en SIP. Un couple TFTP\u00a0+ DHCP fournit le firmware et l\u2019autoprovisioning.\u00a0</p>"},{"location":"Telephonie/Telephonie/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":"<p>Les commandes sont ex\u00e9cut\u00e9es sous Debian 12\u00a0; adaptez les chemins si n\u00e9cessaire.</p>"},{"location":"Telephonie/Telephonie/#21-installation-dasterisk-18","title":"2.1 Installation d\u2019Asterisk\u202f18","text":"<pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y\nsudo apt install wget build-essential subversion -y\ncd /usr/src\nsudo wget http://downloads.asterisk.org/pub/telephony/asterisk/asterisk-18-current.tar.gz\nsudo tar xzf asterisk-18-current.tar.gz\ncd asterisk-18.*\n\n# D\u00e9pendances &amp; codecs\nsudo contrib/scripts/get_mp3_source.sh\nsudo contrib/scripts/install_prereq install           # choisir 33 pour la France\n\nsudo ./configure\nsudo make menuselect    # cocher\u00a0: format_mp3, res_pjsip, app_voicemail\nsudo make -j$(nproc)\nsudo make install\nsudo make samples\nsudo make config\nsudo ldconfig\n</code></pre> <p>Cr\u00e9er l\u2019utilisateur d\u00e9di\u00e9\u00a0:</p> <pre><code>sudo adduser --system --group --no-create-home --disabled-login asterisk\nsudo chown -R asterisk:asterisk /etc/asterisk /var/{lib,log,run,spool}/asterisk\nsudo chmod -R 750 /etc/asterisk\nsudo sed -i 's/;\\?\\(runuser *=\\).*/\\1 asterisk/'  /etc/asterisk/asterisk.conf\nsudo sed -i 's/;\\?\\(rungroup *=\\).*/\\1 asterisk/' /etc/asterisk/asterisk.conf\nsudo systemctl restart asterisk\n</code></pre>"},{"location":"Telephonie/Telephonie/#22-services-dautoprovisioning","title":"2.2 Services d\u2019autoprovisioning","text":"Service Paquet R\u00f4le Interface/VLAN DHCP isc-dhcp-server Attribue IP\u202f+ option\u202f66\u202f\u2192\u202fTFTP VLAN\u202f125 (Voix) TFTP tftpd\u2011hpa Diffuse firmware Cisco &amp; XML VLAN\u202f125 <p>DHCP\u00a0\u2013 extrait\u00a0/etc/dhcp/dhcpd.conf\u202f: <pre><code>subnet 192.168.125.0 netmask 255.255.255.0 {\n  range 192.168.125.20 192.168.125.99;\n  option routers 192.168.125.1;           # SVI ToIP (Asterisk)\n  option tftp-server-name \"192.168.125.130\";  # VM TFTP\n  option bootfile-name   \"XMLDefault.cnf.xml\";\n}\n</code></pre></p> <p>TFTP\u00a0: placez le firmware (<code>SIP42.xx.loads</code>) et les fichiers\u00a0<code>XMLDefault.cnf.xml</code>, <code>dialplan.xml</code>, <code>SEP&lt;MAC&gt;.cnf.xml</code> dans <code>/srv/tftp/</code>.</p>"},{"location":"Telephonie/Telephonie/#23-configuration-des-telephones-cisco","title":"2.3 Configuration des t\u00e9l\u00e9phones Cisco","text":""},{"location":"Telephonie/Telephonie/#231-xmldefaultcnfxml","title":"2.3.1 <code>XMLDefault.cnf.xml</code>","text":"<pre><code>&lt;Default&gt;\n   &lt;callManagerGroup&gt;\n     &lt;members&gt;\n       &lt;member priority=\"0\"&gt;\n         &lt;callManager&gt;\n           &lt;ports&gt;\n             &lt;ethernetPhonePort&gt;2000&lt;/ethernetPhonePort&gt;\n             &lt;mgcpPorts&gt;\n               &lt;listen&gt;2427&lt;/listen&gt;\n               &lt;keepAlive&gt;2428&lt;/keepAlive&gt;\n             &lt;/mgcpPorts&gt;\n           &lt;/ports&gt;\n           &lt;processNodeName&gt;!!!ASTERISK!!!&lt;/processNodeName&gt;\n         &lt;/callManager&gt;\n       &lt;/member&gt;\n     &lt;/members&gt;\n   &lt;/callManagerGroup&gt;\n   &lt;loadInformation434 model=\"Cisco 7942\"&gt;!!!VERSION!!!&lt;/loadInformation434&gt;\n&lt;/Default&gt;\n</code></pre>"},{"location":"Telephonie/Telephonie/#232-dialplanxml","title":"2.3.2 <code>dialplan.xml</code>","text":"<pre><code>&lt;DIALTEMPLATE&gt;\n  &lt;TEMPLATE MATCH=\"....\" Timeout=\"0\"/&gt;\n&lt;/DIALTEMPLATE&gt;\n</code></pre>"},{"location":"Telephonie/Telephonie/#233-sepmaccnfxml","title":"2.3.3 <code>SEP&lt;MAC&gt;.cnf.xml</code>","text":"<pre><code>&lt;device&gt;\n  &lt;deviceProtocol&gt;SIP&lt;/deviceProtocol&gt;\n  &lt;sshUserId&gt;cisco&lt;/sshUserId&gt;\n  &lt;sshPassword&gt;cisco&lt;/sshPassword&gt;\n  &lt;devicePool&gt;\n    &lt;dateTimeSetting&gt;\n      &lt;dateTemplate&gt;D.M.Y&lt;/dateTemplate&gt;\n      &lt;timeZone&gt;E. Europe Standard/Daylight Time&lt;/timeZone&gt;\n      &lt;ntps&gt;\n        &lt;ntp&gt;\n          &lt;name&gt;!!!NTP!!!&lt;/name&gt;\n          &lt;ntpMode&gt;Unicast&lt;/ntpMode&gt;\n        &lt;/ntp&gt;\n      &lt;/ntps&gt;\n    &lt;/dateTimeSetting&gt;\n    &lt;callManagerGroup&gt;\n      &lt;members&gt;\n        &lt;member priority=\"0\"&gt;\n          &lt;callManager&gt;\n            &lt;ports&gt;\n              &lt;ethernetPhonePort&gt;2000&lt;/ethernetPhonePort&gt;\n              &lt;sipPort&gt;5060&lt;/sipPort&gt;\n              &lt;securedSipPort&gt;5061&lt;/securedSipPort&gt;\n            &lt;/ports&gt;\n            &lt;processNodeName&gt;!!!ASTERISK!!!&lt;/processNodeName&gt;\n          &lt;/callManager&gt;\n        &lt;/member&gt;\n      &lt;/members&gt;\n    &lt;/callManagerGroup&gt;\n  &lt;/devicePool&gt;\n  &lt;sipProfile&gt;\n    &lt;sipProxies&gt;\n      &lt;backupProxy&gt;&lt;/backupProxy&gt;\n      &lt;backupProxyPort&gt;&lt;/backupProxyPort&gt;\n      &lt;emergencyProxy&gt;&lt;/emergencyProxy&gt;\n      &lt;emergencyProxyPort&gt;&lt;/emergencyProxyPort&gt;\n      &lt;outboundProxy&gt;&lt;/outboundProxy&gt;\n      &lt;outboundProxyPort&gt;&lt;/outboundProxyPort&gt;\n      &lt;registerWithProxy&gt;true&lt;/registerWithProxy&gt;\n    &lt;/sipProxies&gt;\n    &lt;sipCallFeatures&gt;\n      &lt;cnfJoinEnabled&gt;true&lt;/cnfJoinEnabled&gt;\n      &lt;callForwardURI&gt;x-cisco-serviceuri-cfwdall&lt;/callForwardURI&gt;\n      &lt;callPickupURI&gt;x-cisco-serviceuri-pickup&lt;/callPickupURI&gt;\n      &lt;callPickupListURI&gt;x-cisco-serviceuri-opickup&lt;/callPickupListURI&gt;\n      &lt;callPickupGroupURI&gt;x-cisco-serviceuri-gpickup&lt;/callPickupGroupURI&gt;\n      &lt;meetMeServiceURI&gt;x-cisco-serviceuri-meetme&lt;/meetMeServiceURI&gt;\n      &lt;abbreviatedDialURI&gt;x-cisco-serviceuri-abbrdial&lt;/abbreviatedDialURI&gt;\n      &lt;rfc2543Hold&gt;false&lt;/rfc2543Hold&gt;\n      &lt;callHoldRingback&gt;2&lt;/callHoldRingback&gt;\n      &lt;localCfwdEnable&gt;true&lt;/localCfwdEnable&gt;\n      &lt;semiAttendedTransfer&gt;true&lt;/semiAttendedTransfer&gt;\n      &lt;anonymousCallBlock&gt;2&lt;/anonymousCallBlock&gt;\n      &lt;callerIdBlocking&gt;2&lt;/callerIdBlocking&gt;\n      &lt;dndControl&gt;0&lt;/dndControl&gt;\n      &lt;remoteCcEnable&gt;true&lt;/remoteCcEnable&gt;\n    &lt;/sipCallFeatures&gt;\n    &lt;sipStack&gt;\n      &lt;sipInviteRetx&gt;6&lt;/sipInviteRetx&gt;\n      &lt;sipRetx&gt;10&lt;/sipRetx&gt;\n      &lt;timerInviteExpires&gt;180&lt;/timerInviteExpires&gt;\n      &lt;timerRegisterExpires&gt;3600&lt;/timerRegisterExpires&gt;\n      &lt;timerRegisterDelta&gt;5&lt;/timerRegisterDelta&gt;\n      &lt;timerKeepAliveExpires&gt;120&lt;/timerKeepAliveExpires&gt;\n      &lt;timerSubscribeExpires&gt;120&lt;/timerSubscribeExpires&gt;\n      &lt;timerSubscribeDelta&gt;5&lt;/timerSubscribeDelta&gt;\n      &lt;timerT1&gt;500&lt;/timerT1&gt;\n      &lt;timerT2&gt;4000&lt;/timerT2&gt;\n      &lt;maxRedirects&gt;70&lt;/maxRedirects&gt;\n      &lt;remotePartyID&gt;true&lt;/remotePartyID&gt;\n      &lt;userInfo&gt;None&lt;/userInfo&gt;\n    &lt;/sipStack&gt;\n    &lt;autoAnswerTimer&gt;1&lt;/autoAnswerTimer&gt;\n    &lt;autoAnswerAltBehavior&gt;false&lt;/autoAnswerAltBehavior&gt;\n    &lt;autoAnswerOverride&gt;true&lt;/autoAnswerOverride&gt;\n    &lt;transferOnhookEnabled&gt;false&lt;/transferOnhookEnabled&gt;\n    &lt;enableVad&gt;false&lt;/enableVad&gt;\n    &lt;preferredCodec&gt;g711alaw&lt;/preferredCodec&gt;\n    &lt;dtmfAvtPayload&gt;101&lt;/dtmfAvtPayload&gt;\n    &lt;dtmfDbLevel&gt;3&lt;/dtmfDbLevel&gt;\n    &lt;dtmfOutofBand&gt;avt&lt;/dtmfOutofBand&gt;\n    &lt;alwaysUsePrimeLine&gt;false&lt;/alwaysUsePrimeLine&gt;\n    &lt;alwaysUsePrimeLineVoiceMail&gt;false&lt;/alwaysUsePrimeLineVoiceMail&gt;\n    &lt;kpml&gt;3&lt;/kpml&gt;\n    &lt;natEnabled&gt;false&lt;/natEnabled&gt;\n    &lt;natAddress&gt;&lt;/natAddress&gt;\n    &lt;phoneLabel&gt;!!!NOM!!!&lt;/phoneLabel&gt;\n    &lt;stutterMsgWaiting&gt;0&lt;/stutterMsgWaiting&gt;\n    &lt;callStats&gt;false&lt;/callStats&gt;\n    &lt;silentPeriodBetweenCallWaitingBursts&gt;10&lt;/silentPeriodBetweenCallWaitingBursts&gt;\n    &lt;disableLocalSpeedDialConfig&gt;false&lt;/disableLocalSpeedDialConfig&gt;\n    &lt;startMediaPort&gt;16384&lt;/startMediaPort&gt;\n    &lt;stopMediaPort&gt;32766&lt;/stopMediaPort&gt;\n    &lt;sipLines&gt;\n      &lt;line button=\"1\"&gt;\n        &lt;featureID&gt;9&lt;/featureID&gt;\n        &lt;featureLabel&gt;!!!UTILISATEUR!!!&lt;/featureLabel&gt;\n        &lt;proxy&gt;USECALLMANAGER&lt;/proxy&gt;\n        &lt;port&gt;5060&lt;/port&gt;\n        &lt;name&gt;!!!UTILISATEUR!!!&lt;/name&gt;\n        &lt;displayName&gt;!!!UTILISATEUR!!!&lt;/displayName&gt;\n        &lt;autoAnswer&gt;\n          &lt;autoAnswerEnabled&gt;2&lt;/autoAnswerEnabled&gt;\n        &lt;/autoAnswer&gt;\n        &lt;callWaiting&gt;3&lt;/callWaiting&gt;\n        &lt;authName&gt;!!!UTILISATEUR!!!&lt;/authName&gt;\n        &lt;authPassword&gt;!!!MOTDEPASSE!!!&lt;/authPassword&gt;\n        &lt;sharedLine&gt;false&lt;/sharedLine&gt;\n        &lt;messageWaitingLampPolicy&gt;1&lt;/messageWaitingLampPolicy&gt;\n        &lt;messagesNumber&gt;*97&lt;/messagesNumber&gt;\n        &lt;ringSettingIdle&gt;4&lt;/ringSettingIdle&gt;\n        &lt;ringSettingActive&gt;5&lt;/ringSettingActive&gt;\n        &lt;contact&gt;!!!UTILISATEUR!!!&lt;/contact&gt;\n        &lt;forwardCallInfoDisplay&gt;\n          &lt;callerName&gt;true&lt;/callerName&gt;\n          &lt;callerNumber&gt;true&lt;/callerNumber&gt;\n          &lt;redirectedNumber&gt;true&lt;/redirectedNumber&gt;\n          &lt;dialedNumber&gt;true&lt;/dialedNumber&gt;\n        &lt;/forwardCallInfoDisplay&gt;\n      &lt;/line&gt;\n    &lt;/sipLines&gt;\n    &lt;voipControlPort&gt;5060&lt;/voipControlPort&gt;\n    &lt;dscpForAudio&gt;184&lt;/dscpForAudio&gt;\n    &lt;ringSettingBusyStationPolicy&gt;0&lt;/ringSettingBusyStationPolicy&gt;\n    &lt;dialTemplate&gt;dialplan.xml&lt;/dialTemplate&gt;\n  &lt;/sipProfile&gt;\n  &lt;commonProfile&gt;\n    &lt;phonePassword&gt;1234&lt;/phonePassword&gt;\n    &lt;backgroundImageAccess&gt;true&lt;/backgroundImageAccess&gt;\n    &lt;callLogBlfEnabled&gt;2&lt;/callLogBlfEnabled&gt;\n  &lt;/commonProfile&gt;\n  &lt;loadInformation&gt;!!!VERSION!!!&lt;/loadInformation&gt;\n  &lt;vendorConfig&gt;\n    &lt;disableSpeaker&gt;false&lt;/disableSpeaker&gt;\n    &lt;disableSpeakerAndHeadset&gt;false&lt;/disableSpeakerAndHeadset&gt;\n    &lt;pcPort&gt;1&lt;/pcPort&gt;\n    &lt;settingsAccess&gt;1&lt;/settingsAccess&gt;\n    &lt;garp&gt;0&lt;/garp&gt;\n    &lt;voiceVlanAccess&gt;0&lt;/voiceVlanAccess&gt;\n    &lt;videoCapability&gt;0&lt;/videoCapability&gt;\n    &lt;autoSelectLineEnable&gt;0&lt;/autoSelectLineEnable&gt;\n    &lt;sshAccess&gt;0&lt;/sshAccess&gt;\n    &lt;sshPort&gt;22&lt;/sshPort&gt;\n    &lt;webAccess&gt;0&lt;/webAccess&gt;\n    &lt;spanToPCPort&gt;1&lt;/spanToPCPort&gt;\n    &lt;loggingDisplay&gt;1&lt;/loggingDisplay&gt;\n    &lt;loadServer&gt;&lt;/loadServer&gt;\n  &lt;/vendorConfig&gt;\n  &lt;versionStamp&gt;&lt;/versionStamp&gt;\n  &lt;userLocale&gt;\n    &lt;name&gt;French_France&lt;/name&gt;\n    &lt;langCode&gt;fr&lt;/langCode&gt;\n  &lt;/userLocale&gt;\n  &lt;networkLocale&gt;France&lt;/networkLocale&gt;\n  &lt;networkLocaleInfo&gt;\n    &lt;name&gt;France&lt;/name&gt;\n  &lt;/networkLocaleInfo&gt;\n  &lt;deviceSecurityMode&gt;1&lt;/deviceSecurityMode&gt;\n  &lt;authenticationURL&gt;&lt;/authenticationURL&gt;\n  &lt;directoryURL&gt;&lt;/directoryURL&gt;\n  &lt;idleURL&gt;&lt;/idleURL&gt;\n  &lt;informationURL&gt;&lt;/informationURL&gt;\n  &lt;messagesURL&gt;&lt;/messagesURL&gt;\n  &lt;proxyServerURL&gt;&lt;/proxyServerURL&gt;\n  &lt;servicesURL&gt;&lt;/servicesURL&gt;\n  &lt;dscpForSCCPPhoneConfig&gt;96&lt;/dscpForSCCPPhoneConfig&gt;\n  &lt;dscpForSCCPPhoneServices&gt;0&lt;/dscpForSCCPPhoneServices&gt;\n  &lt;dscpForCm2Dvce&gt;96&lt;/dscpForCm2Dvce&gt;\n  &lt;transportLayerProtocol&gt;2&lt;/transportLayerProtocol&gt;\n  &lt;capfAuthMode&gt;0&lt;/capfAuthMode&gt;\n  &lt;capfList&gt;\n    &lt;capf&gt;\n      &lt;phonePort&gt;3804&lt;/phonePort&gt;\n    &lt;/capf&gt;\n  &lt;/capfList&gt;\n  &lt;certHash&gt;&lt;/certHash&gt;\n  &lt;encrConfig&gt;false&lt;/encrConfig&gt;\n&lt;/device&gt;\n</code></pre>"},{"location":"Telephonie/Telephonie/#24-fichiers-asterisk","title":"2.4 Fichiers Asterisk","text":"<p><code>/etc/asterisk/sip.conf</code>\u00a0\u2013 extraits\u00a0: <pre><code>[general]\ncontext=default\nbindport=5060\nbindaddr=0.0.0.0\nlanguage=fr\nvideosupport=no\n\n[7001](!)\ntype=friend\nhost=dynamic\nsecret=123\ncontext=internal\ncallerid=\"Poste\u00a07001\" &lt;7001&gt;\nqualify=yes\n\n[7002](7001)   ; h\u00e9rite de la section g\u00e9n\u00e9rique\nsecret=456\ncallerid=\"Poste\u00a07002\" &lt;7002&gt;\n</code></pre></p> <p><code>/etc/asterisk/extensions.conf</code>\u00a0\u2013 extrait\u00a0: <pre><code>[internal]\nexten =&gt; _7XXX,1,NoOp(Appel interne vers ${EXTEN})\n same =&gt; n,Dial(SIP/${EXTEN},20)\n same =&gt; n,VoiceMail(${EXTEN}@main,u)\n same =&gt; n,Hangup()\n</code></pre></p> <p><code>/etc/asterisk/voicemail.conf</code>\u00a0: <pre><code>[main]\n7001 =&gt; 123,Poste\u00a07001,,\n7002 =&gt; 456,Poste\u00a07002,,\n</code></pre></p> <p>Appliquer\u00a0: <pre><code>sudo asterisk -rx \"module load chan_sip.so\"\nsudo asterisk -rx \"core reload\"\n</code></pre></p>"},{"location":"Telephonie/Telephonie/#25-tests-et-supervision","title":"2.5 Tests et supervision","text":"<ul> <li>Enregistrement\u00a0: <code>asterisk -rx \"sip show peers\"</code>\u202f\u2192\u202f<code>7001</code> et <code>7002</code> doivent \u00eatre OK (Latency\u202f&lt;\u202f100\u202fms).</li> <li>Appels internes\u00a0: d\u00e9crocher <code>7001</code>\u202f\u2192\u202fcomposer\u00a0<code>7002</code>\u202f\u2192\u202fv\u00e9rifier audio dans les deux sens.</li> <li>QoS\u00a0: Sur le switch, tag VLAN\u00a0125 et configurer\u00a0<code>trust dscp</code>; v\u00e9rifier avec <code>show mls qos interface ...</code>.</li> </ul>"},{"location":"Telephonie/Telephonie/#3-conclusion","title":"3. Conclusion","text":"<p>La solution d\u00e9ploy\u00e9e fournit\u00a0:</p> <ul> <li>Un IPBX Asterisk\u00a018 s\u00e9curis\u00e9, tournant sous utilisateur d\u00e9di\u00e9\u202f<code>asterisk</code>\u202f;</li> <li>Un provisioning automatique des t\u00e9l\u00e9phones Cisco via DHCP option\u202f66 et TFTP (firmware + XML)\u00a0;</li> <li>Des extensions internes (7001,\u00a07002\u2026) disposant de la messagerie vocale ;</li> <li>Un VLAN voix isol\u00e9 (125) garantissant bande passante et latence\u00a0;</li> <li>Une mobilit\u00e9 assur\u00e9e par l\u2019application Zoiper sur SSID\u00a0ToIP.</li> </ul> <p>Ce dispositif r\u00e9pond aux exigences de l\u2019\u00e9valuation BTS\u202fSIO (E6) et peut \u00eatre \u00e9tendu (SIP Trunk, IVR, QoS DSCP) pour accompagner la croissance de Sportludique.</p>"},{"location":"Telephonie/TrunkSIP/","title":"Guide de configuration \u2013 Trunk SIP inter\u2011sites Entreprise\u00a0\u2194\u00a0Agence","text":""},{"location":"Telephonie/TrunkSIP/#1-contexte-telephonie-unifiee-et-optimisation-des-couts","title":"1. Contexte : t\u00e9l\u00e9phonie unifi\u00e9e et optimisation des co\u00fbts","text":"<p>La mise en place du tunnel IPsec entre le si\u00e8ge de Sportludique (Tours) et l\u2019agence de Bordeaux permet d\u00e9sormais de faire circuler le trafic en toute s\u00e9curit\u00e9. Pour aller plus loin, l\u2019entreprise souhaite :</p> <ul> <li>Unifier les communications internes : appeler un collaborateur \u00e0 Bordeaux doit \u00eatre aussi simple qu\u2019un appel interne au si\u00e8ge\u202f;</li> <li>R\u00e9duire les co\u00fbts : supprimer les appels sortants via l\u2019op\u00e9rateur pour le trafic inter\u2011sites\u202f;</li> <li>Simplifier l\u2019exploitation : un seul plan de num\u00e9rotation;</li> <li>Pr\u00e9parer la mont\u00e9e en charge : la solution doit pouvoir int\u00e9grer d\u2019autres agences \u00e0 moyen terme.</li> </ul> <p>Un trunk SIP priv\u00e9 entre les deux IPBX Asterisk r\u00e9pond \u00e0 ces enjeux\u00a0: le signalisation SIP et le m\u00e9dia RTP passent \u00e0 travers le tunnel IPsec, sans exposition sur Internet.</p>"},{"location":"Telephonie/TrunkSIP/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":"<p>Les blocs ci\u2011dessous sont \u00e0 ins\u00e9rer tels quels dans vos fichiers <code>sip.conf</code> et <code>extensions.conf</code>et de les modifier \u00e0 vos besoins.</p>"},{"location":"Telephonie/TrunkSIP/#21-ipbx-entreprise-tours","title":"2.1 IPBX Entreprise (Tours)","text":""},{"location":"Telephonie/TrunkSIP/#211-etcasterisksipconf","title":"2.1.1 <code>/etc/asterisk/sip.conf</code>","text":"<pre><code>;--------------------------------------------------\n; TRUNK SIP sortant / entrant vers le PBX Agence\n;--------------------------------------------------\n[agence-trunk]\ntype=peer\nhost=10.0.128.135            ; IP fixe du serveur Agence\ncontext=from-agence          ; contexte o\u00f9 arrivent SES appels\ndisallow=all\nallow=ulaw\nallow=alaw\ndirectmedia=yes              ; RTP direct : utile car pas de NAT\ninsecure=port,invite         ; pas d\u2019authentification (labo)\nqualify=yes                  ; ping SIP toutes les 60 s\n</code></pre>"},{"location":"Telephonie/TrunkSIP/#212-etcasteriskextensionsconf","title":"2.1.2 <code>/etc/asterisk/extensions.conf</code>","text":"<pre><code>include =&gt; outgoing-agence\n\n;---------------------------------------------------------------------\n;  SORTANT \u2013 tout 7xx ou 8xx (3 chiffres) part vers le trunk Agence\n;---------------------------------------------------------------------\n[outgoing-agence]\nexten =&gt; _7XX,1,NoOp(Envoi ${EXTEN} vers Agence via trunk)\n same  =&gt; n,Dial(SIP/${EXTEN}@agence-trunk)\n same  =&gt; n,Hangup()\n\nexten =&gt; _8XX,1,NoOp(Envoi ${EXTEN} vers Agence via trunk)\n same  =&gt; n,Dial(SIP/${EXTEN}@agence-trunk)\n same  =&gt; n,Hangup()\n\n;---------------------------------------------------------------------\n;  ENTRANT \u2013 appels re\u00e7us du trunk Agence\n;---------------------------------------------------------------------\n[from-agence]\nexten =&gt; _7XXX,1,NoOp(Appel entrant de l\u2019Agence vers ${EXTEN})\n same  =&gt; n,Dial(SIP/${EXTEN},15)\n same  =&gt; n,Playback(vm-nobodyavail)\n same  =&gt; n,VoiceMail(${EXTEN}@main)\n same  =&gt; n,Hangup()\n\nexten =&gt; _8XXX,1,NoOp(Appel entrant de l\u2019Agence vers ${EXTEN})\n same  =&gt; n,Dial(SIP/${EXTEN},15)\n same  =&gt; n,Playback(vm-nobodyavail)\n same  =&gt; n,VoiceMail(${EXTEN}@main)\n same  =&gt; n,Hangup()\n</code></pre>"},{"location":"Telephonie/TrunkSIP/#22-ipbx-agence-bordeaux","title":"2.2 IPBX Agence (Bordeaux)","text":""},{"location":"Telephonie/TrunkSIP/#221-etcasterisksipconf","title":"2.2.1 <code>/etc/asterisk/sip.conf</code>","text":"<pre><code>;--------------------------------------------------\n; TRUNK SIP vers le PBX ENTREPRISE\n;--------------------------------------------------\n[entreprise-trunk]\ntype=peer\nhost=192.168.125.130         ; IP fixe du serveur Entreprise\ncontext=from-entreprise      ; o\u00f9 arrivent SES appels\ndisallow=all\nallow=ulaw\nallow=alaw\ndirectmedia=yes              ; RTP direct : pas de NAT\ninsecure=port,invite         ; pas d\u2019auth (labo)\nqualify=yes                  ; ping SIP toutes les 60 s\n</code></pre>"},{"location":"Telephonie/TrunkSIP/#222-etcasteriskextensionsconf","title":"2.2.2 <code>/etc/asterisk/extensions.conf</code>","text":"<pre><code>include =&gt; outgoing-entreprise\n\n;---------------------------------------------------------------------\n;  SORTANT : tout num\u00e9ro 7xxx / 8xxx part vers le trunk\n;---------------------------------------------------------------------\n[outgoing-entreprise]\nexten =&gt; _7XXX,1,NoOp(Envoi ${EXTEN} vers Entreprise via trunk)\n same  =&gt; n,Dial(SIP/${EXTEN}@entreprise-trunk)\n same  =&gt; n,Hangup()\n\nexten =&gt; _8XXX,1,NoOp(Envoi ${EXTEN} vers Entreprise via trunk)\n same  =&gt; n,Dial(SIP/${EXTEN}@entreprise-trunk)\n same  =&gt; n,Hangup()\n\n;---------------------------------------------------------------------\n;  ENTRANT : appels venant d\u2019Entreprise\n;---------------------------------------------------------------------\n[from-entreprise]\n; L\u2019Entreprise nous envoie des 7xxx ou 8xxx\nexten =&gt; _7XX,1,NoOp(Appel entrant de l\u2019Entreprise vers ${EXTEN})\n same  =&gt; n,Dial(SIP/${EXTEN},15)\n same  =&gt; n,Playback(vm-nobodyavail)\n same  =&gt; n,VoiceMail(${EXTEN}@main)\n same  =&gt; n,Hangup()\n\nexten =&gt; _8XX,1,NoOp(Appel entrant de l\u2019Entreprise vers ${EXTEN})\n same  =&gt; n,Dial(SIP/${EXTEN},15)\n same  =&gt; n,Playback(vm-nobodyavail)\n same  =&gt; n,VoiceMail(${EXTEN}@main)\n same  =&gt; n,Hangup()\n</code></pre>"},{"location":"Telephonie/TrunkSIP/#23-note-ipsec-phase-2-dediee-au-vlan-voix-inserer-photo","title":"2.3 Note IPsec \u2013 Phase\u00a02 d\u00e9di\u00e9e au VLAN Voix (INSERER\u00a0PHOTO)","text":"<p>Le tunnel IPsec existant transporte d\u00e9j\u00e0 le trafic \u00ab\u00a0Data\u00a0\u00bb. Pour garantir le marquage QoS et \u00e9viter tout NAT sur la VoIP, ajoutez une seconde Phase\u202f2 sur chaque pare\u2011feu\u00a0:</p> Site R\u00e9seau local R\u00e9seau distant Usage Entreprise 192.168.125.0/24 (VLAN\u00a0Voix) 10.0.128.0/24 (Voix Agence) VoIP \u2194 SIP/RTP Agence 10.0.128.0/24 192.168.125.0/24 Sym\u00e9trique"},{"location":"Telephonie/TrunkSIP/#3-conclusion","title":"3. Conclusion","text":"<p>Le trunk SIP entre l\u2019Entreprise et l\u2019Agence est maintenant op\u00e9rationnel\u00a0; il s\u2019appuie sur le tunnel IPsec existant pour assurer un trafic confidentiel et sans surco\u00fbt. Les collaborateurs composent simplement les num\u00e9ros internes (7xx /\u00a08xx) pour joindre leurs homologues, tandis que l\u2019infrastructure reste pr\u00eate \u00e0 accueillir de nouveaux sites ou services (visio, centres d\u2019appels) sans modification majeure.</p> <p>Cette mise en place s\u2019int\u00e8gre donc parfaitement \u00e0 la strat\u00e9gie de convergence IP de Sportludique tout en constituant un \u00e9l\u00e9ment valorisable lors de l\u2019\u00e9valuation E6.</p>"},{"location":"VPN/IPSec/","title":"Guide de configuration \u2013 VPN\u202fIPsec site\u2011\u00e0\u2011site (pfSense)","text":""},{"location":"VPN/IPSec/#1-contexte-interconnexion-securisee-bordeaux-tours","title":"1. Contexte : interconnexion s\u00e9curis\u00e9e Bordeaux \u2194 Tours","text":"<p>Suite au rachat d\u2019une agence \u00e0 Bordeaux et au lancement d\u2019E\u2011Sportludique, l\u2019entreprise doit relier son infrastructure centrale (site de Tours) au r\u00e9seau de l\u2019agence\u202f\u2014\u202ftout en garantissant confidentialit\u00e9, int\u00e9grit\u00e9 et disponibilit\u00e9 des donn\u00e9es traversant Internet.</p> <p>Exigences identifi\u00e9es (Cahier des charges E6)\u00a0:</p> Objectif D\u00e9tail VPN chiffr\u00e9 Tunnel IPsec AES\u2011256 entre pare\u2011feux pfSense (VM) ; aucun service tiers requis Interop\u00e9rabilit\u00e9 totale Les h\u00f4tes des deux LAN doivent communiquer comme sur un m\u00eame r\u00e9seau interne (services AD, ERP, sauvegardes) Fiabilit\u00e9 Le tunnel doit se r\u00e9\u2011\u00e9tablir automatiquement apr\u00e8s coupure ; supervision dans les tableaux pfSense Co\u00fbt ma\u00eetris\u00e9 Solutions open\u2011source / licences existantes ; d\u00e9ploiement internalis\u00e9 Conformit\u00e9 BTS SIO Illustration des comp\u00e9tences\u00a0: conception, d\u00e9ploiement, supervision (bloc ASR) <p>Pourquoi IPsec\u00a0? Par rapport \u00e0 SSL\u00a0VPN ou GRE\u00a0+\u00a0IPsec\u00a0:</p> <ul> <li>Norme IETF largement support\u00e9e\u202f: compatibilit\u00e9 routeurs, firewalls, clients natifs\u202f;</li> <li>Mode site\u2011\u00e0\u2011site transparent (routage statique ou OSPF)\u202f;</li> <li>Chiffrement bout\u2011en\u2011bout (IKEv2 + AES\u2011GCM) sans d\u00e9pendance applicative\u202f;</li> <li>Gestion fine des sous\u2011r\u00e9seaux et des politiques de chiffrement.</li> </ul>"},{"location":"VPN/IPSec/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":""},{"location":"VPN/IPSec/#3-conclusion","title":"3. Conclusion","text":"<p>La liaison IPsec site\u2011\u00e0\u2011site offre\u00a0:</p> <ul> <li>Transparence\u00a0: utilisateurs, serveurs et t\u00e9l\u00e9phones IP \u00e9changent comme s\u2019ils \u00e9taient sur le m\u00eame LAN\u202f;</li> <li>S\u00e9curit\u00e9\u00a0: chiffrement AES\u2011256/ SHA\u2011256 + PFS, authentification r\u00e9ciproque par PSK ou certificats\u202f;</li> <li>R\u00e9silience\u00a0: reconnexion automatique apr\u00e8s perte de lien ; monitoring visuel via l\u2019onglet Status\u202f\u203a\u202fIPsec de pfSense\u202f;</li> <li>Scalabilit\u00e9\u00a0: possibilit\u00e9 d\u2019ajouter d\u2019autres sites (hub\u2011and\u2011spoke) ou des road\u2011warriors IKEv2 sans modifier l\u2019architecture actuelle.</li> </ul>"},{"location":"VPN/SSL/","title":"VPN SSL","text":"<p>Guide de configuration \u2013 VPN\u00a0SSL (OpenVPN) sur Stormshield\u00a0SNS</p>"},{"location":"VPN/SSL/#1-contexte-acces-nomade-securise-pour-sportludique","title":"1. Contexte\u00a0: acc\u00e8s nomade s\u00e9curis\u00e9 pour Sportludique","text":"<p>Les collaborateurs nomades (t\u00e9l\u00e9travail, d\u00e9placement, wifi publics) doivent acc\u00e9der aux ressources internes (ERP, partage de fichiers, intranet) via une connexion chiffr\u00e9e. Le pare\u2011feu Stormshield\u00a0SNS int\u00e8gre un service VPN\u00a0SSL complet (moteur OpenVPN), id\u00e9al car\u00a0:</p> <ul> <li>Fonctionne sur TCP\u202f443 ou UDP\u202f1194\u00a0\u2192 passe les filtrages stricts\u202f;</li> <li>Authentification forte\u00a0: certificats\u00a0X.509 + annuaire LDAP/AD\u00a0;</li> <li>Distribution automatique du client et de la configuration via le portail captif\u00a0;</li> <li>Int\u00e9gration compl\u00e8te aux r\u00e8gles de filtrage, proxies et QoS du pare\u2011feu.</li> </ul>"},{"location":"VPN/SSL/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":"<p>Version SNS\u00a04.x\u2009; capture d\u2019\u00e9cran \u00e0 ajouter\u00a0\u2192 PHOTO\u00a0X.</p>"},{"location":"VPN/SSL/#21-prerequis","title":"2.1 Pr\u00e9\u2011requis","text":"<ol> <li>Annuaire reli\u00e9 \u00e0 l'active directory activ\u00e9\u202f;</li> <li>M\u00e9thode d\u2019authentification explicite (LDAP/AD, RADIUS, Kerberos) activ\u00e9e\u202f;</li> <li>Profil portail captif associ\u00e9 \u00e0 l\u2019interface externe.</li> </ol> <p>PHOTO\u00a01\u00a0\u2013 M\u00e9thode d\u2019authentification + portail</p>"},{"location":"VPN/SSL/#22-activation-du-serveur-vpn-ssl","title":"2.2 Activation du serveur VPN\u00a0SSL","text":"<ol> <li>Configuration \u203a VPN \u203a VPN\u00a0SSL\u00a0\u2192 cocher Activer le VPN\u00a0SSL.</li> <li>Renseigner\u00a0:</li> <li>Adresse publique ou FQDN du pare\u2011feu\u00a0;</li> <li>R\u00e9seaux accessibles (objets internes)\u00a0;</li> <li>DNS suffix + serveurs DNS internes\u00a0;</li> <li>Plages d\u2019adresses d\u00e9di\u00e9es TCP &amp;\u202fUDP (ex.\u00a010.60.77.0/24 et\u00a010.61.77.0/24).</li> <li>Laisser l\u2019algorithme de ren\u00e9gociation \u00e0 14\u202f400\u202fs (4\u202fh) ou ajuster.</li> </ol> <p>PHOTO\u00a02\u00a0\u2013 Param\u00e8tres r\u00e9seau &amp; certificats</p>"},{"location":"VPN/SSL/#23-certificats","title":"2.3 Certificats","text":"<ul> <li>CA par d\u00e9faut\u00a0<code>sslvpn-full-default-authority</code> suffisante.</li> <li>Pour CA perso\u00a0: importer certificat serveur + certificat client sign\u00e9s par la m\u00eame CA.</li> </ul>"},{"location":"VPN/SSL/#24-droits-dacces","title":"2.4 Droits d\u2019acc\u00e8s","text":"<ol> <li>Configuration \u203a Utilisateurs \u203a Droits d\u2019acc\u00e8s.</li> <li>Laisser l\u2019acc\u00e8s global sur Interdire et cr\u00e9er une r\u00e8gle Acc\u00e8s d\u00e9taill\u00e9 \u21d2 s\u00e9lectionner le groupe Nomades \u2192 Autoriser VPN\u00a0SSL.</li> </ol> <p>PHOTO\u00a03\u00a0\u2013 R\u00e8gle d\u2019autorisation</p>"},{"location":"VPN/SSL/#25-politique-de-securite","title":"2.5 Politique de s\u00e9curit\u00e9","text":"Sens Objet source Objet dest. Service Action WAN \u2192 UTM <code>Any</code> Interface\u00a0Ext <code>1194/UDP</code>, <code>443/TCP</code> Allow VPN_clients \u2192 LAN <code>VPN_SSL_Clients</code> <code>LAN_Nets</code> <code>Any</code> Allow / IPS\u00a0On VPN_clients \u2192 Internet <code>VPN_SSL_Clients</code> <code>any</code> <code>Any</code> NAT\u00a0\u2192 WAN IP <p>Activer la r\u00e8gle implicite \u00ab\u00a0Acc\u00e8s au portail d\u2019authentification et au VPN\u00a0SSL\u00a0\u00bb si non pr\u00e9sent.</p>"},{"location":"VPN/SSL/#26-client-vpn-windows","title":"2.6 Client VPN (Windows)","text":"<ol> <li>T\u00e9l\u00e9charger Stormshield\u00a0SSL\u00a0VPN Client depuis https://Pare\u2011feu/auth (PHOTO\u00a04).</li> <li>Lancer l\u2019installation (droits administrateur requis).</li> <li>Premier lancement\u00a0: renseigner</li> <li>Serveur\u00a0: <code>vpn.tours.sportludique.fr</code> (ou IP) [+\u00a0<code>:port</code> si custom]\u00a0;</li> <li>Identifiant / mot\u00a0de passe LDAP.</li> <li>Le client t\u00e9l\u00e9charge automatiquement <code>openvpn_client.zip</code>\u00a0(\u202fCA, cert\u202f, conf) et \u00e9tablit le tunnel.</li> </ol> <p>Codes couleur\u00a0: Rouge\u00a0=\u00a0d\u00e9connect\u00e9, Jaune\u00a0=\u00a0n\u00e9gociation, Vert\u00a0=\u00a0connect\u00e9.</p>"},{"location":"VPN/SSL/#27-client-openvpn-linux","title":"2.7 Client OpenVPN (Linux)","text":"<p>D\u00e9compresser <code>openvpn_client.zip</code>\u00a0: <pre><code>o unzip openvpn_client.zip -d ~/vpn_ssl\nsudo openvpn --config client.ovpn\n</code></pre> Extrait de <code>client.ovpn</code>\u00a0: <pre><code>dev tun\nremote vpn.tours.sportludique.fr 1194 udp\ncipher AES-256-CBC\nauth SHA256\nca CA.cert.pem\ncert openvpnclient.cert.pem\nkey  openvpnclient.pkey.pem\ncompress lz4\nauth-user-pass\nauth-nocache\n</code></pre> Pour Network\u2011Manager\u00a0: PHOTO\u00a05 \u2013 onglet Identit\u00e9 / Avanc\u00e9.</p>"},{"location":"VPN/SSL/#28-verifications-supervision","title":"2.8 V\u00e9rifications &amp; supervision","text":"<ul> <li>Pare\u2011feu\u00a0: Supervision \u203a Tunnels VPN\u00a0SSL (PHOTO\u00a06).</li> <li>Traces client Windows\u00a0: clic droit \u2192 Logs.</li> <li>Route Linux\u00a0: <code>ip route show dev tun0</code>\u00a0: pr\u00e9sence route par d\u00e9faut 10.60.77.5.</li> </ul>"},{"location":"VPN/SSL/#3-conclusion","title":"3. Conclusion","text":"<p>Le VPN\u00a0SSL complet offre\u00a0:</p> <ul> <li>Authentification LDAP + certificats\u00a0X.509\u202f;</li> <li>Chiffrement TLS sur ports 1194/UDP ou 443/TCP (bypass proxy)\u202f;</li> <li>Acc\u00e8s transparent aux r\u00e9seaux internes avec contr\u00f4le par les r\u00e8gles du pare\u2011feu\u202f;</li> <li>Distribution automatis\u00e9e de la configuration (ZIP) pour une exp\u00e9rience utilisateur simplifi\u00e9e\u202f;</li> <li>Supervision centralis\u00e9e des tunnels et int\u00e9gration aux logs Stormshield.</li> </ul> <p>La solution garantit ainsi confidentialit\u00e9, int\u00e9grit\u00e9 et continuit\u00e9 de service pour les utilisateurs nomades de Sportludique.</p>"},{"location":"ha/carp/","title":"Guide de configuration\u00a0\u2013 Haute disponibilit\u00e9 CARP sur pfSense","text":""},{"location":"ha/carp/#1-contexte-resilience-des-parefeux","title":"1. Contexte\u00a0: r\u00e9silience des pare\u2011feux","text":"<p>Pour \u00e9viter tout point de d\u00e9faillance unique, la plateforme Sportludique s\u2019appuie sur deux pare\u2011feux pfSense en mode haute disponibilit\u00e9. Le protocole CARP (Common Address Redundancy Protocol) publie des adresses IP virtuelles communes aux deux n\u0153uds\u00a0; l\u2019instance \u00ab\u00a0Master\u00a0\u00bb traite le trafic, tandis que la seconde reste en \u00ab\u00a0Backup\u00a0\u00bb et prend imm\u00e9diatement le relais en cas de panne.</p>"},{"location":"ha/carp/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":""},{"location":"ha/carp/#21-interface-dediee-a-la-synchronisation","title":"2.1 Interface d\u00e9di\u00e9e \u00e0 la synchronisation","text":"<ol> <li>Ouvrez Interfaces\u00a0\u203a Assignments et ajoutez l\u2019interface physique r\u00e9serv\u00e9e \u00e0 la synchronisation.</li> <li>Attribuez des adresses IP dans le m\u00eame sous\u2011r\u00e9seau\u00a0:</li> <li>Pare\u2011feu principal\u00a0: <code>172.28.138.1/24</code></li> <li>Pare\u2011feu secondaire\u00a0: <code>172.28.138.2/24</code></li> <li>Activez l\u2019interface et sauvegardez.</li> </ol> <p>PHOTO\u00a01\u00a0\u2013 Interface Assignment</p>"},{"location":"ha/carp/#22-synchronisation-sur-le-parefeu-principal","title":"2.2 Synchronisation sur le pare\u2011feu principal","text":"<ol> <li>Rendez\u2011vous dans System\u00a0\u203a High Availability Sync.</li> <li>Cochez Enable State Synchronization et s\u00e9lectionnez l\u2019interface d\u00e9di\u00e9e.</li> <li>Renseignez l\u2019adresse IP du secondaire (<code>172.28.138.2</code>).</li> <li>Activez la synchronisation XMLRPC, puis indiquez\u00a0:</li> <li>IP du secondaire\u00a0: <code>172.28.138.2</code></li> <li>Identifiants administrateur.</li> <li>S\u00e9lectionnez tous les objets \u00e0 synchroniser et cliquez sur Save.</li> </ol> <p>PHOTO\u00a02\u00a0\u2013 High Availability Sync (Primary)</p>"},{"location":"ha/carp/#23-regles-firewall-sur-linterface-carp","title":"2.3 R\u00e8gles firewall sur l\u2019interface CARP","text":"<p>Dans Firewall\u00a0\u203a Rules (onglet de l\u2019interface d\u00e9di\u00e9e)\u00a0:</p> Action Proto Source Destination Port Objet Pass PFSYNC CARP net CARP address \u2014 Synchronisation d\u2019\u00e9tat Pass TCP CARP address CARP net 443 XMLRPC <p>Appliquez et sauvegardez.</p> <p>PHOTO\u00a03\u00a0\u2013 Rules on CARP Interface</p>"},{"location":"ha/carp/#24-creation-des-adresses-virtuelles-vip","title":"2.4 Cr\u00e9ation des adresses virtuelles (VIP)","text":"<ol> <li>Acc\u00e9dez \u00e0 Firewall\u00a0\u203a Virtual\u00a0IPs et cliquez sur Add.</li> <li>Param\u00e9trez\u00a0:</li> <li>Type\u00a0: CARP</li> <li>Interface\u00a0: WAN (ou LAN)</li> <li>Virtual IP\u00a0: adresse partag\u00e9e (ex. <code>x.x.x.x/24</code>)</li> <li>VHID et Password s\u00e9curis\u00e9s</li> <li>R\u00e9p\u00e9tez pour chaque interface (WAN, LAN, DMZ\u2026).</li> </ol> <p>PHOTO\u00a04\u00a0\u2013 Virtual IPs list</p>"},{"location":"ha/carp/#25-configuration-minimale-sur-le-secondaire","title":"2.5 Configuration minimale sur le secondaire","text":"<p>Dans System\u00a0\u203a High Availability Sync, cochez uniquement Enable State Synchronization, s\u00e9lectionnez l\u2019interface CARP et renseignez l\u2019IP du primaire (<code>172.28.138.1</code>). Ne configurez pas XMLRPC ici\u00a0; il sera g\u00e9r\u00e9 par le primaire.</p> <p>PHOTO\u00a05\u00a0\u2013 High Availability Sync (Secondary)</p>"},{"location":"ha/carp/#26-validation-et-tests","title":"2.6 Validation et tests","text":"<ol> <li>Mettez \u00e0 jour les passerelles sur vos h\u00f4tes/routeurs pour pointer vers les VIP.</li> <li>Simulez une panne du pare\u2011feu primaire et observez le basculement instantan\u00e9 (Status\u00a0\u203a CARP).</li> </ol> <p>PHOTO\u00a06\u00a0\u2013 Status CARP</p>"},{"location":"ha/carp/#3-notes-importantes","title":"3. Notes importantes","text":"<ul> <li>Les configurations des deux n\u0153uds doivent rester strictement identiques (packages, r\u00e8gles, certificates, etc.). XMLRPC s\u2019en charge\u00a0; v\u00e9rifiez les journaux apr\u00e8s chaque modification.</li> <li>Utilisez toujours une interface physique d\u00e9di\u00e9e pour CARP afin d\u2019isoler le trafic de synchronisation.</li> <li>Pensez \u00e0 autoriser le protocole PFSYNC et le port 443 (XMLRPC) sur l\u2019interface CARP uniquement.</li> </ul>"},{"location":"ha/carp/#4-conclusion","title":"4. Conclusion","text":"<p>Votre cluster pfSense b\u00e9n\u00e9ficie d\u00e9sormais d\u2019une haute disponibilit\u00e9\u00a0: les VIP maintiennent la connectivit\u00e9 c\u00f4t\u00e9 clients, la synchronisation PFSYNC pr\u00e9serve les \u00e9tats des connexions, et XMLRPC r\u00e9plique la configuration. V\u00e9rifiez r\u00e9guli\u00e8rement le statut CARP pour anticiper tout d\u00e9salignement entre les n\u0153uds.</p>"},{"location":"ha/hsrp/","title":"Guide de configuration \u2013 HSRP sur TRS\u2011GW\u201101\u2011FIBRE et TRS\u2011GW\u201102\u2011ADSL","text":""},{"location":"ha/hsrp/#1-contexte-redondance-de-passerelle","title":"1. Contexte : redondance de passerelle","text":"<p>Le protocole HSRP (Hot Standby Router Protocol) permet de pr\u00e9senter une passerelle IP virtuelle unique aux h\u00f4tes d\u2019un m\u00eame segment r\u00e9seau. Lorsqu\u2019il est mis en \u0153uvre sur les routeurs TRS\u2011GW\u201101\u2011FIBRE et TRS\u2011GW\u201102\u2011ADSL, il garantit :</p> <ul> <li>Continuit\u00e9 de service : en cas de d\u00e9faillance du routeur actif, le routeur de secours prend imm\u00e9diatement le relais ;</li> <li>Simplicit\u00e9 de configuration c\u00f4t\u00e9 client : une seule passerelle par d\u00e9faut (IP virtuelle) \u00e0 diffuser sur le VLAN\u202f224 ;</li> <li>Basculement contr\u00f4l\u00e9 : prise en compte des priorit\u00e9s et du m\u00e9canisme preempt pour le retour automatique du routeur principal.</li> </ul>"},{"location":"ha/hsrp/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":""},{"location":"ha/hsrp/#21-routeur-principal-trsgw01fibre","title":"2.1 Routeur principal \u2013 TRS\u2011GW\u201101\u2011FIBRE","text":"<pre><code>conf t\ninterface GigabitEthernet0/0.224\n standby 1 ip 192.168.224.1      ! Adresse IP virtuelle\n standby 1 priority 120          ! Priorit\u00e9 la plus \u00e9lev\u00e9e\n standby 1 preempt               ! Reprend le r\u00f4le actif apr\u00e8s r\u00e9tablissement\nexit\n</code></pre>"},{"location":"ha/hsrp/#22-routeur-de-secours-trsgw02adsl","title":"2.2 Routeur de secours \u2013 TRS\u2011GW\u201102\u2011ADSL","text":"<pre><code>conf t\ninterface GigabitEthernet0/0.224\n standby 1 ip 192.168.224.1      ! Adresse IP virtuelle partag\u00e9e\n standby 1 priority 115          ! Priorit\u00e9 inf\u00e9rieure \u2192 standby\n standby 1 preempt               ! Peut redevenir actif si l\u2019autre chute\nexit\n</code></pre> <p>Remarque\u2002: v\u00e9rifiez que les adresses IP physiques des deux routeurs sur le sous\u2011interface GigabitEthernet0/0.224 restent uniques (ex.\u202f:\u202f192.168.224.2 et .3) et que le d\u00e9lai HSRP hello/hold par d\u00e9faut (3/10\u202fs) couvre vos exigences de convergence. Adaptez\u2011le avec <code>standby 1 timers msec 1000 3000</code> si n\u00e9cessaire.</p>"},{"location":"ha/hsrp/#23-validation","title":"2.3 Validation","text":"<pre><code>show standby brief        ! R\u00e9sum\u00e9 de l\u2019\u00e9tat HSRP\nshow standby              ! D\u00e9tails : priorit\u00e9, r\u00f4le, minuteurs\n</code></pre> <p>Sortie attendue\u00a0:</p> <ul> <li>TRS\u2011GW\u201101\u2011FIBRE\u00a0: <code>State = Active</code>, <code>Priority = 120</code>, <code>Virtual IP = 192.168.224.1</code> ;</li> <li>TRS\u2011GW\u201102\u2011ADSL\u00a0: <code>State = Standby</code>, <code>Priority = 115</code>, m\u00eame IP virtuelle.</li> </ul>"},{"location":"ha/hsrp/#3-conclusion","title":"3. Conclusion","text":"<p>Cette mise en \u0153uvre d\u2019HSRP offre \u00e0 Sportludique une passerelle virtuelle r\u00e9siliente sur le VLAN\u202f224\u00a0:</p> <ul> <li>Actif\u00a0: TRS\u2011GW\u201101\u2011FIBRE (priority\u202f120) ;</li> <li>Secours\u00a0: TRS\u2011GW\u201102\u2011ADSL (priority\u202f115).</li> </ul> <p>En cas de panne du routeur principal, la bascule est automatique et transparente\u202f; lors de son retour, le m\u00e9canisme preempt restitue la hi\u00e9rarchie initiale sans intervention manuelle.</p>"},{"location":"ha/lacp/","title":"Guide de configuration \u2013 Agr\u00e9gation de liens (LACP)","text":""},{"location":"ha/lacp/#1-contexte-agregation-entre-trsswcore-et-lhyperviseur-proxmox","title":"1. Contexte\u00a0: agr\u00e9gation entre TRS\u2011SW\u2011CORE et l\u2019hyperviseur\u00a0Proxmox","text":"<p>Pour fournir \u00e0 la plateforme de virtualisation Proxmox un acc\u00e8s r\u00e9seau haut d\u00e9bit et tol\u00e9rant aux pannes, deux liaisons Gigabit (Gi1/0/18 et Gi1/0/19) du switch TRS\u2011SW\u2011CORE sont agr\u00e9g\u00e9es via LACP dans le Port\u2011channel\u00a01. Ce lien logique, pr\u00e9sent\u00e9 c\u00f4t\u00e9 Proxmox sous forme de bond 802.3ad, permet\u00a0:</p> <ul> <li>Addition de la bande passante : cumule le d\u00e9bit des liens physiques\u202f;</li> <li>Basculage automatique : maintien de la connectivit\u00e9 si un c\u00e2ble ou un transceiver tombe\u202f;</li> <li>Transport multi\u2011VLAN : chaque r\u00e9seau (management, production, DMZ\u2026) reste isol\u00e9 tout en partageant la m\u00eame paire de fibres.</li> </ul> <p>Cette architecture \u00e9limine les points de d\u00e9faillance uniques entre le c\u0153ur et l\u2019hyperviseur tout en simplifiant la configuration IP c\u00f4t\u00e9 Proxmox.</p>"},{"location":"ha/lacp/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":""},{"location":"ha/lacp/#21-creation-de-linterface-logique","title":"2.1 Cr\u00e9ation de l\u2019interface logique","text":"<pre><code>interface Port-channel1\n description Uplink_Proxmox_Agreg\n switchport mode trunk            # Transporte les VLAN utilis\u00e9s par les VMs\n ! Optionnel\u00a0: limiter la liste des VLAN\n ! switchport trunk allowed vlan 125,220-229\n</code></pre>"},{"location":"ha/lacp/#22-ajout-des-interfaces-physiques","title":"2.2 Ajout des interfaces physiques","text":"<pre><code>interface GigabitEthernet1/0/18\n description Proxmox_LACP_1\n switchport mode trunk\n channel-group 1 mode active       # N\u00e9gociation LACP\n!\ninterface GigabitEthernet1/0/19\n description Proxmox_LACP_2\n switchport mode trunk\n channel-group 1 mode active       # N\u00e9gociation LACP\n</code></pre>"},{"location":"ha/lacp/#23-validation","title":"2.3 Validation","text":"<pre><code># Afficher la configuration du Port-channel\nshow run interface Port-channel1\n\n# V\u00e9rifier l\u2019\u00e9tat LACP et les membres\nshow etherchannel summary\n</code></pre>"},{"location":"ha/lacp/#3-conclusion","title":"3. Conclusion","text":"<p>L\u2019agr\u00e9gation LACP entre TRS\u2011SW\u2011CORE et Proxmox offre\u00a0:</p> <ul> <li>D\u00e9bit agr\u00e9g\u00e9 correspondant \u00e0 la somme des interfaces membres\u202f;</li> <li>Continuit\u00e9 de service gr\u00e2ce au basculement instantan\u00e9 sur le lien restant\u202f;</li> <li>Gestion unifi\u00e9e avec un seul Port\u2011channel c\u00f4t\u00e9 switch et un bond 802.3ad c\u00f4t\u00e9 hyperviseur.</li> </ul> <p>Cette configuration garantit des performances r\u00e9seau optimales pour l\u2019ensemble des machines virtuelles tout en renfor\u00e7ant la disponibilit\u00e9 de l\u2019infrastructure.</p>"},{"location":"ha/rulesipsla/","title":"Guide de configuration \u2013 IP SLA et suivi HSRP","text":""},{"location":"ha/rulesipsla/#1-contexte-supervision-proactive-de-la-connectivite-wan","title":"1. Contexte\u00a0: supervision proactive de la connectivit\u00e9 WAN","text":"<p>Dans l\u2019architecture Sportludique, les routeurs TRS\u2011GW\u201101\u2011FIBRE (actif) et TRS\u2011GW\u201102\u2011ADSL (secours) utilisent HSRP pour fournir une passerelle virtuelle sur le VLAN\u00a0224. Pour garantir un basculement pertinent, il est indispensable d\u2019\u00e9valuer en continu l\u2019\u00e9tat r\u00e9el des liaisons WAN\u00a0:</p> Plan Objectif M\u00e9canisme Couche\u00a03 Adresse IP virtuelle et priorit\u00e9 HSRP Couche\u00a03 Sant\u00e9 de la route de sortie (ping passerelle FAI) IP\u00a0SLA\u00a0+\u00a0Track <p>En associant IP\u00a0SLA au suivi HSRP\u00a0:</p> <ul> <li>le routeur dissimule les incidents li\u00e9s \u00e0 l\u2019interface locale (up/down)\u00a0;</li> <li>le basculement s\u2019enclenche si la passerelle FAI n\u2019est plus joignable\u00a0;</li> <li>la priorit\u00e9 HSRP est d\u00e9cr\u00e9ment\u00e9e dynamiquement (\u201310) pour c\u00e9der le r\u00f4le actif au routeur de secours.</li> </ul>"},{"location":"ha/rulesipsla/#2-procedure-de-configuration","title":"2. Proc\u00e9dure de configuration","text":""},{"location":"ha/rulesipsla/#21-routeur-principal-trsgw01fibre","title":"2.1 Routeur principal\u00a0\u2013 TRS\u2011GW\u201101\u2011FIBRE","text":"<pre><code>! 1. Cr\u00e9er l\u2019IP\u00a0SLA n\u00b01\nip sla 1\n icmp-echo 183.44.37.2 source-interface GigabitEthernet0/1\n frequency 30\nexit\n!\n! 2. Planifier l\u2019ex\u00e9cution en continu\nip sla schedule 1 life forever start-time now\n!\n! 3. Associer \u00e0 un objet de suivi\ntrack 1 ip sla 1 reachability\n!\n! 4. Lier le suivi au groupe HSRP sur le sous\u2011interface WAN interne\ninterface GigabitEthernet0/0.224\n standby 1 track 1 decrement 10\n</code></pre>"},{"location":"ha/rulesipsla/#22-routeur-de-secours-trsgw02adsl","title":"2.2 Routeur de secours\u00a0\u2013 TRS\u2011GW\u201102\u2011ADSL","text":"<pre><code>ip sla 1\n icmp-echo 221.87.128.1 source-interface GigabitEthernet0/1\n frequency 30\nexit\nip sla schedule 1 life forever start-time now\n!\ntrack 1 ip sla 1 reachability\n!\ninterface GigabitEthernet0/0.224\n standby 1 track 1 decrement 10\n</code></pre> <p>Param\u00e8tres cl\u00e9s\u00a0: * <code>frequency 30</code>\u00a0: intervalle de 30\u00a0s entre deux tests ICMP. * <code>decrement 10</code>\u00a0: abaisse la priorit\u00e9 HSRP de 10 points si le suivi \u00e9choue.</p>"},{"location":"ha/rulesipsla/#23-validation","title":"2.3 Validation","text":"<pre><code># Statistiques IP\u00a0SLA\nshow ip sla statistics\n\n# \u00c9tat des objets de suivi\nshow track\n\n# R\u00f4le HSRP et priorit\u00e9 effective\nshow standby brief\n</code></pre>"},{"location":"ha/rulesipsla/#3-conclusion","title":"3. Conclusion","text":"<p>La combinaison IP\u00a0SLA\u00a0+\u00a0Track fournit une d\u00e9tection fine des coupures WAN\u00a0; elle compl\u00e8te HSRP pour assurer\u00a0:</p> <ul> <li>un basculement rapide vers la passerelle de secours en cas de perte de connectivit\u00e9 vers le FAI\u00a0;</li> <li>un retour automatique au routeur fibre lorsque la liaison redevient op\u00e9rationnelle\u00a0;</li> <li>une continuit\u00e9 de service per\u00e7ue par les h\u00f4tes, sans modification de leur passerelle par d\u00e9faut.</li> </ul> <p>Cet ensemble renforce la r\u00e9silience du r\u00e9seau Sportludique face aux incidents de transport.</p>"},{"location":"ha/haproxy/01-https-loadbalancer/","title":"Configuration \u2013 HAProxy sur Debian","text":""},{"location":"ha/haproxy/01-https-loadbalancer/#1-contexte-repartition-de-charge-pour-sportludiquefr","title":"1. Contexte : r\u00e9partition de charge pour <code>sportludique.fr</code>","text":"<p>Afin d\u2019am\u00e9liorer la r\u00e9silience et la performance de son site vitrine <code>sportludique.fr</code>, la DSI a choisi de mettre en place une infrastructure d\u2019\u00e9quilibrage de charge bas\u00e9e sur HAProxy. Ce r\u00e9partiteur sera charg\u00e9 de distribuer les requ\u00eates web entrantes entre deux fermes de serveurs :</p> <ul> <li>Un cluster principal local (on-premise)</li> <li>Un cluster de secours activable si n\u00e9cessaire</li> </ul> <p>Cette mise en place r\u00e9pond aux besoins suivants :</p> <ul> <li>R\u00e9partition \u00e9quitable du trafic HTTP/HTTPS (round-robin)</li> <li>Terminaison TLS unique pour simplifier la gestion des certificats</li> <li>Persistance de session utilisateur (via IP source)</li> <li>Supervision des serveurs backends avec d\u00e9tection automatique de panne</li> <li>\u00c9volutivit\u00e9 par ajout ou retrait de serveurs sans coupure</li> </ul>"},{"location":"ha/haproxy/01-https-loadbalancer/#2-installation-et-configuration-de-haproxy","title":"2. Installation et configuration de HAProxy","text":""},{"location":"ha/haproxy/01-https-loadbalancer/#21-installation-sur-debian","title":"2.1 Installation sur Debian","text":"<pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y\nsudo apt install haproxy -y\nhaproxy -v  # V\u00e9rification de la version\n</code></pre>"},{"location":"ha/haproxy/01-https-loadbalancer/#22-fichier-etchaproxyhaproxycfg","title":"2.2 Fichier <code>/etc/haproxy/haproxy.cfg</code>","text":""},{"location":"ha/haproxy/01-https-loadbalancer/#a-section-global-et-defaults","title":"a) Section <code>global</code> et <code>defaults</code>","text":"<pre><code>global\n    log /dev/log local0\n    log /dev/log local1 notice\n    chroot /var/lib/haproxy\n    stats socket /run/haproxy/admin.sock mode 660 level admin\n    stats timeout 30s\n    user haproxy\n    group haproxy\n    daemon\n\n    ca-base  /etc/ssl/certs\n    crt-base /etc/ssl/private\n\n    ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:...\n    ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:...\n    ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets\n\ndefaults\n    log     global\n    mode    http\n    option  httplog\n    option  dontlognull\n    timeout connect 5000\n    timeout client  50000\n    timeout server  50000\n    errorfile 400 /etc/haproxy/errors/400.http\n    errorfile 403 /etc/haproxy/errors/403.http\n    errorfile 408 /etc/haproxy/errors/408.http\n    errorfile 500 /etc/haproxy/errors/500.http\n    errorfile 502 /etc/haproxy/errors/502.http\n    errorfile 503 /etc/haproxy/errors/503.http\n    errorfile 504 /etc/haproxy/errors/504.http\n</code></pre>"},{"location":"ha/haproxy/01-https-loadbalancer/#b-frontend-https","title":"b) Frontend HTTPS","text":"<pre><code>frontend wwwtest\n    bind *:80\n    bind *:443 ssl crt /etc/ssl/tours.sportludique.fr/tours.sportludique.fr.pem\n    mode http\n    default_backend wwwtest_http_backend\n</code></pre>"},{"location":"ha/haproxy/01-https-loadbalancer/#c-backend-avec-equilibre-de-charge","title":"c) Backend avec \u00e9quilibre de charge","text":"<pre><code>backend wwwtest_http_backend\n    mode http\n    balance roundrobin\n    option forwardfor\n    stick-table type ip size 100k expire 5m\n    stick on src\n    server srv-http1 192.168.37.110:80 check\n    server srv-http2 192.168.37.115:80 check\n</code></pre>"},{"location":"ha/haproxy/01-https-loadbalancer/#23-certificats-tls","title":"2.3 Certificats TLS","text":"<p>Concat\u00e9nez le certificat et la cl\u00e9 priv\u00e9e dans un fichier <code>.pem</code> :</p> <pre><code>sudo mkdir -p /etc/ssl/tours.sportludique.fr\ncat cert.crt privkey.key &gt; /etc/ssl/tours.sportludique.fr/tours.sportludique.fr.pem\nsudo chown root:root /etc/ssl/tours.sportludique.fr/tours.sportludique.fr.pem\nsudo chmod 600 /etc/ssl/tours.sportludique.fr/tours.sportludique.fr.pem\n</code></pre>"},{"location":"ha/haproxy/01-https-loadbalancer/#24-lancement-et-activation","title":"2.4 Lancement et activation","text":"<pre><code>sudo haproxy -c -f /etc/haproxy/haproxy.cfg  # V\u00e9rification\nsudo systemctl restart haproxy\nsudo systemctl enable haproxy\n</code></pre>"},{"location":"ha/haproxy/01-https-loadbalancer/#25-verifications","title":"2.5 V\u00e9rifications","text":"<pre><code>sudo ss -tulpn | grep haproxy         # V\u00e9rifier que les ports 80 et 443 sont ouverts\nsudo tail -f /var/log/haproxy.log     # Suivi des requ\u00eates et erreurs\n</code></pre>"},{"location":"ha/haproxy/01-https-loadbalancer/#3-resultat-attendu","title":"3. R\u00e9sultat attendu","text":"<p>Le service <code>sportludique.fr</code> est d\u00e9sormais :</p> <ul> <li>Accessible en HTTP et HTTPS depuis LAN et Internet</li> <li>S\u00e9curis\u00e9 avec un certificat sign\u00e9 par l\u2019AC STS Root R2</li> <li>R\u00e9parti entre plusieurs serveurs web de mani\u00e8re transparente</li> <li>R\u00e9silient en cas de panne d\u2019un backend</li> <li>Capable de maintenir les sessions actives par IP</li> </ul> <p>\u27a1\ufe0f \u00c9tape suivante : 02 \u2013 Mise en place de VRRP avec Keepalived</p>"},{"location":"ha/haproxy/02-vrrp-keepalived/","title":"Configuration de la haute disponibilit\u00e9 avec Keepalived (VRRP)","text":"<p>\ud83d\udcc4 Fichier : <code>02-vrrp-keepalived.md</code> \ud83d\udcc1 Emplacement : <code>docs/ha/haproxy/</code></p>"},{"location":"ha/haproxy/02-vrrp-keepalived/#1-objectif","title":"1. Objectif","text":"<p>Assurer une haute disponibilit\u00e9 active/passive entre deux serveurs HAProxy (<code>TRS-SRV-RP01</code> et <code>TRS-SRV-RP02</code>) gr\u00e2ce au protocole VRRP, via Keepalived.</p> <p>Le syst\u00e8me utilise une IP virtuelle partag\u00e9e (<code>192.168.37.150</code>) qui bascule automatiquement vers le serveur restant en cas de d\u00e9faillance.</p>"},{"location":"ha/haproxy/02-vrrp-keepalived/#2-informations-systeme","title":"2. Informations syst\u00e8me","text":"\u00c9l\u00e9ment Valeur Interface VRRP <code>ens3</code> IP Master <code>192.168.37.151</code> IP Backup <code>192.168.37.152</code> IP virtuelle <code>192.168.37.150</code> VRID <code>51</code> Auth type <code>PASS</code> Mot de passe <code>kaboom</code> --- <p>Souhaite-tu que je g\u00e9n\u00e8re aussi un petit script Bash pour surveiller l'\u00e9tat de l'IP flottante ou pour tester automatiquement la bascule ?</p>"},{"location":"ha/haproxy/02-vrrp-keepalived/#3-installation-de-keepalived","title":"3. Installation de Keepalived","text":"<p>Sur chaque serveur (RP01 et RP02) :</p> <pre><code>sudo apt update\nsudo apt install keepalived -y\n</code></pre>"},{"location":"ha/haproxy/02-vrrp-keepalived/#4-fichier-de-configuration-keepalivedconf","title":"4. Fichier de configuration \u2013 <code>keepalived.conf</code>","text":""},{"location":"ha/haproxy/02-vrrp-keepalived/#sur-trs-srv-rp01-master","title":"Sur <code>TRS-SRV-RP01</code> (MASTER)","text":"<pre><code>vrrp_instance VI_1 {\n    state MASTER\n    interface ens3\n    virtual_router_id 51\n    priority 100\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass kaboom\n    }\n    virtual_ipaddress {\n        192.168.37.150\n    }\n    track_interface {\n        ens3\n    }\n}\n</code></pre>"},{"location":"ha/haproxy/02-vrrp-keepalived/#sur-trs-srv-rp02-backup","title":"Sur <code>TRS-SRV-RP02</code> (BACKUP)","text":"<p>M\u00eame configuration, \u00e0 l\u2019exception de :</p> <pre><code>state BACKUP\npriority 90\n</code></pre>"},{"location":"ha/haproxy/02-vrrp-keepalived/#5-demarrage-et-test","title":"5. D\u00e9marrage et test","text":""},{"location":"ha/haproxy/02-vrrp-keepalived/#commandes-de-gestion","title":"Commandes de gestion","text":"<pre><code>sudo systemctl enable keepalived\nsudo systemctl start keepalived\nsudo systemctl status keepalived\n</code></pre>"},{"location":"ha/haproxy/02-vrrp-keepalived/#verification-de-lip-virtuelle","title":"V\u00e9rification de l'IP virtuelle","text":"<p>Sur le MASTER (<code>TRS-SRV-RP01</code>) :</p> <pre><code>ip a show ens3 | grep 192.168.37.150\n</code></pre> <p>L'IP virtuelle doit appara\u00eetre.</p>"},{"location":"ha/haproxy/02-vrrp-keepalived/#6-test-de-bascule-failover","title":"6. Test de bascule (failover)","text":"<ol> <li>Arr\u00eater le service Keepalived sur <code>RP01</code> :</li> </ol> <pre><code>sudo systemctl stop keepalived\n</code></pre> <ol> <li> <p>Sur <code>RP02</code>, l'IP <code>192.168.37.150</code> doit appara\u00eetre automatiquement dans <code>ip a</code>.</p> </li> <li> <p>Red\u00e9marrer Keepalived sur <code>RP01</code> pour le retour \u00e0 la normale :</p> </li> </ol> <pre><code>sudo systemctl start keepalived\n</code></pre>"},{"location":"ha/haproxy/02-vrrp-keepalived/#7-conclusion","title":"7. Conclusion","text":"<p>Gr\u00e2ce \u00e0 Keepalived, la configuration assure :</p> <ul> <li>Une IP flottante assurant l\u2019entr\u00e9e unique pour les utilisateurs ;</li> <li>Une reprise imm\u00e9diate en cas de d\u00e9faillance d\u2019un noeud HAProxy ;</li> <li>Une supervision simple et efficace, ind\u00e9pendante des applications.</li> </ul> <p>\u27a1\ufe0f \u00c9tape suivante : 03 \u2013 Finalisation de la configuration avec Trustus et HTTPS</p>"},{"location":"ha/haproxy/03-haproxy-finalisation/","title":"Finalisation et am\u00e9lioration de la configuration HAProxy","text":""},{"location":"ha/haproxy/03-haproxy-finalisation/#1-objectif","title":"1. Objectif","text":"<p>Cette \u00e9tape a pour but de finaliser l\u2019infrastructure HAProxy d\u00e9ploy\u00e9e pour le site <code>tours.sportludique.fr</code> en :</p> <ul> <li>Redirigeant proprement le domaine racine vers <code>www.</code></li> <li>Int\u00e9grant le sous-domaine <code>trustus.tours.sportludique.fr</code></li> <li>Corrigeant la gestion des certificats</li> <li>S\u00e9curisant le trafic HTTPS</li> <li>Pr\u00e9parant le syst\u00e8me \u00e0 l\u2019\u00e9volutivit\u00e9 et \u00e0 la supervision</li> </ul>"},{"location":"ha/haproxy/03-haproxy-finalisation/#2-points-de-vigilance","title":"2. Points de vigilance","text":"<ul> <li>Chemin du certificat TLS : le certificat <code>.pem</code> utilis\u00e9 pour HTTPS est stock\u00e9 ici :</li> </ul> <pre><code>/etc/ssl/tours.sportludique.fr/tours.sportludique.fr.pem\n</code></pre> <p>Il doit contenir la cl\u00e9 priv\u00e9e + le certificat concat\u00e9n\u00e9s.</p> <ul> <li> <p>Ajout du sous-domaine <code>trustus.tours.sportludique.fr</code> dans le DNS :</p> </li> <li> <p>Entr\u00e9e A vers <code>192.168.37.150</code> (l\u2019IP virtuelle de VRRP)</p> </li> <li>Visible sur le LAN, et potentiellement NAT\u00e9 en externe</li> </ul>"},{"location":"ha/haproxy/03-haproxy-finalisation/#3-fichier-haproxycfg-finalise","title":"3. Fichier <code>haproxy.cfg</code> finalis\u00e9","text":"<p>Le fichier de configuration HAProxy final comporte les \u00e9l\u00e9ments suivants :</p>"},{"location":"ha/haproxy/03-haproxy-finalisation/#a-section-global-et-defaults","title":"a) Section <code>global</code> et <code>defaults</code>","text":"<pre><code>global\n    log /dev/log local0\n    log /dev/log local1 notice\n    chroot /var/lib/haproxy\n    stats socket /run/haproxy/admin.sock mode 660 level admin\n    stats timeout 30s\n    user haproxy\n    group haproxy\n    daemon\n\n    ca-base /etc/ssl/certs\n    crt-base /etc/ssl/private\n\n    ssl-default-bind-ciphers ECDHE-...\n    ssl-default-bind-ciphersuites TLS_AES_...\n    ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets\n\ndefaults\n    log     global\n    mode    http\n    option  httplog\n    option  dontlognull\n    timeout connect 5000\n    timeout client  50000\n    timeout server  50000\n    errorfile 400 /etc/haproxy/errors/400.http\n    ...\n</code></pre>"},{"location":"ha/haproxy/03-haproxy-finalisation/#b-frontend-http-port-80","title":"b) Frontend HTTP (port 80)","text":"<pre><code>frontend frontend_http\n    bind *:80\n    mode http\n\n    acl is_root      hdr(host) -i tours.sportludique.fr\n    acl is_www       hdr(host) -i www.tours.sportludique.fr\n    acl is_trustus   hdr(host) -i trustus.tours.sportludique.fr\n\n    use_backend backend_www      if is_www\n    use_backend backend_trustus  if is_trustus\n\n    redirect location https://www.tours.sportludique.fr code 301 if is_root\n    redirect location https://www.tours.sportludique.fr code 301\n</code></pre>"},{"location":"ha/haproxy/03-haproxy-finalisation/#c-frontend-https-port-443","title":"c) Frontend HTTPS (port 443)","text":"<pre><code>frontend frontend_https\n    bind *:443 ssl crt /etc/ssl/tours.sportludique.fr/tours.sportludique.fr.pem\n    mode http\n\n    acl is_root      hdr(host) -i tours.sportludique.fr\n    acl is_www       hdr(host) -i www.tours.sportludique.fr\n    acl is_trustus   hdr(host) -i trustus.tours.sportludique.fr\n\n    use_backend backend_www      if is_www\n    use_backend backend_trustus  if is_trustus\n\n    redirect location https://www.tours.sportludique.fr code 301 if is_root\n    default_backend backend_www\n</code></pre>"},{"location":"ha/haproxy/03-haproxy-finalisation/#d-backend-principal-www","title":"d) Backend principal \u2013 <code>www</code>","text":"<pre><code>backend backend_www\n    mode http\n    balance roundrobin\n    option forwardfor\n    stick-table type ip size 100k expire 5m\n    stick on src\n    server web1 192.168.37.110:80 check\n    server web2 192.168.37.115:80 check\n</code></pre>"},{"location":"ha/haproxy/03-haproxy-finalisation/#e-backend-secondaire-trustus","title":"e) Backend secondaire \u2013 <code>trustus</code>","text":"<pre><code>backend backend_trustus\n    mode http\n    option forwardfor\n    server trustus 192.168.37.60:80 check port 80\n</code></pre>"},{"location":"ha/haproxy/03-haproxy-finalisation/#4-conseils-supplementaires","title":"4. Conseils suppl\u00e9mentaires","text":"<ul> <li> <p>Ajoute un VirtualHost Apache sur le serveur <code>trustus</code> pour servir :</p> </li> <li> <p>Le certificat racine : <code>https://trustus.tours.sportludique.fr/ca.crt</code></p> </li> <li>Une page HTML d\u2019aide \u00e0 l\u2019installation manuelle</li> <li>Pense \u00e0 configurer un <code>/stats</code> pour visualiser l'\u00e9tat des HAProxy :</li> </ul> <p><pre><code>listen stats\n    bind *:9000\n    stats enable\n    stats uri /\n    stats realm Haproxy\\ Statistics\n    stats auth admin:kaboom\n</code></pre> * V\u00e9rifie les permissions du fichier <code>.pem</code> :</p> <pre><code>sudo chmod 600 /etc/ssl/tours.sportludique.fr/tours.sportludique.fr.pem\n</code></pre>"},{"location":"ha/haproxy/03-haproxy-finalisation/#5-conclusion","title":"5. Conclusion","text":"<p>La configuration HAProxy finale permet d\u00e9sormais :</p> <ul> <li>Une publication HTTPS propre pour plusieurs sous-domaines</li> <li>Un routage intelligent bas\u00e9 sur l\u2019URL demand\u00e9e</li> <li>L\u2019ajout d\u2019un service auxiliaire <code>trustus</code> pour l\u2019infrastructure PKI</li> <li>Une r\u00e9silience maximale gr\u00e2ce au cluster HAProxy supervis\u00e9 par VRRP</li> </ul>"},{"location":"ha/haproxy/intro/","title":"Mise en place de la haute disponibilit\u00e9 avec HAProxy et VRRP","text":""},{"location":"ha/haproxy/intro/#contexte","title":"Contexte","text":"<p>Dans le cadre de l\u2019am\u00e9lioration de la visibilit\u00e9 et de la continuit\u00e9 de service du site web vitrine de SportLudique (<code>tours.sportludique.fr</code>), la DSI souhaite mettre en place une infrastructure hautement disponible. L\u2019objectif est de garantir un acc\u00e8s au site m\u00eame en cas de panne d\u2019un serveur, en assurant une r\u00e9partition de charge ainsi qu\u2019une tol\u00e9rance aux pannes r\u00e9seau ou mat\u00e9rielles.</p> <p>Pour cela, l\u2019architecture retenue repose sur :</p> <ul> <li>Deux serveurs HAProxy (TRS-SRV-RP-01 et TRS-SRV-RP-02) configur\u00e9s en haute disponibilit\u00e9 via VRRP</li> <li>Deux serveurs web (TRS-SRV-WEB-01 et TRS-SRV-WEB-02) h\u00e9bergeant le contenu du site</li> <li>Une adresse IP virtuelle commune, assur\u00e9e par VRRP, utilis\u00e9e comme point d\u2019entr\u00e9e unique</li> <li>Une publication du site \u00e0 la fois sur le r\u00e9seau local (LAN) et Internet</li> <li>Une gestion des sessions persistantes pour les utilisateurs, bas\u00e9e sur l\u2019adresse IP</li> <li>Une connexion s\u00e9curis\u00e9e HTTPS, avec un certificat sign\u00e9 par l\u2019autorit\u00e9 STS Root R2</li> <li>Une entr\u00e9e DNS pour le domaine <code>tours.sportludique.fr</code> pointant vers l\u2019IP virtuelle du cluster</li> </ul>"},{"location":"ha/haproxy/intro/#schema-de-larchitecture","title":"Sch\u00e9ma de l'architecture","text":"<p>Voici le sch\u00e9ma illustrant l\u2019infrastructure redond\u00e9e avec VRRP et HAProxy :</p> <p></p>"},{"location":"ha/haproxy/intro/#objectifs-techniques","title":"Objectifs techniques","text":"<ul> <li>R\u00e9partition de charge automatique entre plusieurs serveurs web</li> <li>Bascule transparente en cas de d\u00e9faillance d\u2019un serveur HAProxy</li> <li>Support des connexions HTTPS avec certificat TLS</li> <li>Gestion des sessions utilisateurs gr\u00e2ce \u00e0 la persistance IP</li> <li>Accessibilit\u00e9 depuis le LAN interne et depuis Internet via NAT/PAT ou DMZ</li> <li>Enregistrement DNS ad\u00e9quat dans le serveur local et public, si n\u00e9cessaire</li> </ul>"}]}